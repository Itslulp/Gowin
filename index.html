<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù† | Your Safe Haven</title>

    <!-- Basic SEO -->
    <meta name="description" content="Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù†: Ù…Ø³Ø§Ø­Ø© Ù‡Ø§Ø¯Ø¦Ø© Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©ØŒ Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡ØŒ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø¨Ø³ÙŠØ·Ø©ØŒ Ù‚ØµØµ Ø§Ù„Ù†ÙˆÙ…ØŒ ÙˆØ§Ù‚ØªØ¨Ø§Ø³Ø§Øª ÙŠÙˆÙ…ÙŠØ© Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©.">
    <meta name="keywords" content="Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù†, Ø§Ø³ØªØ±Ø®Ø§Ø¡, Ù…Ø­Ø§Ø¯Ø«Ø©, Ø£Ù„Ø¹Ø§Ø¨ Ù‡Ø§Ø¯Ø¦Ø©, Ù‚ØµØµ Ù†ÙˆÙ…, Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª, Ù…ÙˆÙ‚Ø¹ Ù…Ø±ÙŠØ­, Your Safe Haven">
    <meta name="author" content="Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù†">

    <!-- Open Graph (for WhatsApp, Twitter, etc.) -->
    <!-- ØµÙˆØ±Ø© Ù‚Ù…Ø± ÙˆÙ†Ø¬ÙˆÙ… Ù‡Ø§Ø¯Ø¦Ø© Ù…Ù† Unsplash (Ù…Ø¬Ø§Ù†ÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…) -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù† | Your Safe Haven">
    <meta property="og:description" content="Ù…Ø³Ø§Ø­ØªÙƒ Ø§Ù„Ù‡Ø§Ø¯Ø¦Ø© Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©ØŒ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§ØªØŒ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ØŒ ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡ ÙˆÙ‚ØµØµ Ø§Ù„Ù†ÙˆÙ….">
    <meta property="og:image" content="https://images.unsplash.com/photo-1534447677768-be436bb09401?auto=format&fit=crop&w=1200&q=80">
    <meta property="og:url" content="https://example.com/">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù† | Your Safe Haven">
    <meta name="twitter:description" content="Ù…Ø³Ø§Ø­ØªÙƒ Ø§Ù„Ù‡Ø§Ø¯Ø¦Ø© Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø©ØŒ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§ØªØŒ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ØŒ ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡ ÙˆÙ‚ØµØµ Ø§Ù„Ù†ÙˆÙ….">
    <meta name="twitter:image" content="https://images.unsplash.com/photo-1534447677768-be436bb09401?auto=format&fit=crop&w=1200&q=80">

    <!-- Favicon (Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…ØªØµÙØ­ ÙˆØ§Ù„Ø¨Ø­Ø«) -->
    <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù‚Ù…Ø± Ø¨Ø³ÙŠØ·Ø© -->
    <link rel="icon" type="image/png" href="https://images.unsplash.com/photo-1500534314211-0a24cd98a43e?auto=format&fit=crop&w=256&q=70">

    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Tajawal', 'Poppins', sans-serif;
            overflow-x: hidden;
        }
        .bg-animated {
            background: linear-gradient(-45deg, #1a1a2e, #16213e, #0f3460, #1a1a2e, #16213e);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        .floating-panel {
            transform: translateY(110vh);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            width: 95%;
            max-width: 550px;
            margin: 0 auto;
            border-top-left-radius: 2.5rem;
            border-top-right-radius: 2.5rem;
            height: 75vh;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            box-shadow: 0 -15px 40px rgba(0,0,0,0.7);
            z-index: 100;
        }
        .floating-panel.active {
            transform: translateY(0);
        }
        .backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 90;
        }
        .backdrop.active {
            opacity: 1;
            visibility: visible;
        }
        .menu-btn {
            transition: all 0.2s ease;
        }
        .menu-btn:active {
            transform: scale(0.95);
        }
        .chat-bubble {
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .glow {
            box-shadow: 0 0 20px rgba(147, 112, 219, 0.3);
        }
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(147, 112, 219, 0.5);
            border-radius: 3px;
        }
        .game-card:hover {
            transform: translateY(-5px);
        }
        .pulse-btn {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(147, 112, 219, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(147, 112, 219, 0); }
        }
    </style>
</head>
<body class="bg-animated min-h-screen text-white">
    <!-- Stars Background -->
    <div class="stars" id="stars"></div>

    <!-- Clickable Backdrop to close panels -->
    <div id="panelBackdrop" class="backdrop" onclick="closeAllPanels()"></div>
    
    <!-- Hidden YouTube Audio (set dynamically for daily/refresh rotation) -->
    <iframe id="bgMusic" class="hidden" width="0" height="0" src="" allow="autoplay; encrypted-media" frameborder="0" allowfullscreen></iframe>
    
    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-gradient-to-b from-black/50 to-transparent p-4">
        <div class="flex justify-between items-center max-w-6xl mx-auto">
            <button id="langToggle" class="menu-btn bg-purple-600/80 hover:bg-purple-700 px-4 py-2 rounded-full text-sm font-medium backdrop-blur-sm">
                <span id="langText">English</span>
            </button>
            <h1 class="text-xl md:text-2xl font-bold text-center flex-1" id="siteTitle">âœ¨ Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù† âœ¨</h1>
            
            <div class="flex gap-2">
                <button onclick="toggleMenu()" class="menu-btn bg-purple-600/80 hover:bg-purple-700 p-2 rounded-full backdrop-blur-sm">
                    â˜°
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation Menu (Side Drawer) -->
    <div id="sideMenu" class="fixed inset-y-0 right-0 w-64 bg-gray-900/95 backdrop-blur-xl z-[60] transform translate-x-full transition-transform duration-300 border-l border-purple-500/30">
        <div class="p-6">
            <button onclick="toggleMenu()" class="mb-8 text-2xl">âœ•</button>
            <nav class="space-y-4">
                <button onclick="openPanel('chat'); toggleMenu();" class="w-full text-right p-3 hover:bg-purple-600/20 rounded-xl flex items-center gap-3">
                    <span>ğŸ’¬</span> <span id="menuChat">Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</span>
                </button>
                <button onclick="openPanel('messages'); toggleMenu();" class="w-full text-right p-3 hover:bg-purple-600/20 rounded-xl flex items-center gap-3">
                    <span>âœ‰ï¸</span> <span id="menuMessages">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</span>
                </button>
                <button onclick="openPanel('games'); toggleMenu();" class="w-full text-right p-3 hover:bg-purple-600/20 rounded-xl flex items-center gap-3">
                    <span>ğŸ®</span> <span id="menuGames">Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</span>
                </button>
                <button onclick="openPanel('quotes'); toggleMenu();" class="w-full text-right p-3 hover:bg-purple-600/20 rounded-xl flex items-center gap-3">
                    <span>ğŸ’­</span> <span id="menuQuotes">Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª</span>
                </button>
                <button onclick="openPanel('relax'); toggleMenu();" class="w-full text-right p-3 hover:bg-purple-600/20 rounded-xl flex items-center gap-3">
                    <span>ğŸ§˜</span> <span id="menuRelax">ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡</span>
                </button>
                <button onclick="openPanel('stories'); toggleMenu();" class="w-full text-right p-3 hover:bg-purple-600/20 rounded-xl flex items-center gap-3">
                    <span>ğŸ“–</span> <span id="menuStories">Ù‚ØµØµ Ø§Ù„Ù†ÙˆÙ…</span>
                </button>
                <button onclick="openPanel('music'); toggleMenu();" class="w-full text-right p-3 hover:bg-purple-600/20 rounded-xl flex items-center gap-3">
                    <span>ğŸµ</span> <span id="menuMusic">Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ù‡Ø§Ø¯Ø¦Ø©</span>
                </button>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <main class="pt-32 pb-24 px-4 relative z-10 flex flex-col items-center justify-center min-h-[80vh]">
        <div class="max-w-4xl mx-auto text-center">
            <!-- Welcome Section -->
            <section class="mb-12">
                <h2 class="text-4xl md:text-6xl font-bold mb-6" id="welcomeTitle">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù†</h2>
                <p class="text-purple-200 text-xl opacity-80" id="welcomeDesc">Ù…ÙƒØ§Ù†Ùƒ Ù„Ù„Ø±Ø§Ø­Ø© ÙˆØ§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡ ÙˆØ§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù† Ø¶ØºÙˆØ· Ø§Ù„Ø­ÙŠØ§Ø©</p>
            </section>

            <!-- Home Quote Display -->
            <div id="homeQuote" class="bg-white/5 backdrop-blur-md p-8 rounded-3xl border border-white/10 glow">
                <p id="mainQuoteText" class="text-2xl md:text-3xl font-medium leading-relaxed mb-4 italic"></p>
                <p id="mainQuoteAuthor" class="text-purple-300"></p>
                <button onclick="nextQuote()" class="mt-6 text-sm bg-purple-600/40 hover:bg-purple-600/60 px-4 py-2 rounded-full transition-all">
                    ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³ â†»
                </button>
            </div>
        </div>
    </main>

    <!-- Chat Panel -->
    <div id="chatPanel" class="floating-panel fixed z-40 bg-gray-900/98 backdrop-blur-2xl">
        <div class="h-full flex flex-col">
            <div class="p-5 border-b border-purple-500/30 flex justify-between items-center bg-gray-900/50 rounded-t-3xl">
                <h3 class="text-xl font-bold" id="chatTitle">ğŸ’¬ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</h3>
                <button onclick="closePanel('chat')" class="text-3xl font-bold w-10 h-10 flex items-center justify-center rounded-full bg-white/10 hover:bg-white/20 transition-colors">âœ•</button>
            </div>
            <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-4"></div>
            <div class="p-4 border-t border-purple-500/30">
                <div class="flex gap-2">
                    <input type="text" id="chatInput" class="flex-1 bg-gray-800 rounded-full px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." onkeypress="if(event.key==='Enter')sendMessage()">
                    <button onclick="sendMessage()" class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-full font-medium" id="sendBtn">Ø¥Ø±Ø³Ø§Ù„</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Games Panel -->
    <div id="gamesPanel" class="floating-panel fixed z-40 bg-gray-900/98 backdrop-blur-2xl overflow-y-auto">
        <div class="p-5 border-b border-pink-500/30 flex justify-between items-center sticky top-0 bg-gray-900/98 z-10 rounded-t-3xl">
            <h3 class="text-xl font-bold" id="gamesTitle">ğŸ® Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
            <button onclick="closePanel('games')" class="text-3xl font-bold w-10 h-10 flex items-center justify-center rounded-full bg-white/10 hover:bg-white/20 transition-colors">âœ•</button>
        </div>
        <div id="gamesContent" class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4 pb-12"></div>
    </div>

    <!-- Quotes Panel -->
    <div id="quotesPanel" class="floating-panel fixed z-40 bg-gray-900/98 backdrop-blur-2xl overflow-y-auto">
        <div class="p-5 border-b border-teal-500/30 flex justify-between items-center sticky top-0 bg-gray-900/98 z-10 rounded-t-3xl">
            <h3 class="text-xl font-bold" id="quotesTitle">ğŸ’­ Ø§Ù‚ØªØ¨Ø§Ø³ Ø§Ù„ÙŠÙˆÙ…</h3>
            <button onclick="closePanel('quotes')" class="text-3xl font-bold w-10 h-10 flex items-center justify-center rounded-full bg-white/10 hover:bg-white/20 transition-colors">âœ•</button>
        </div>
        <div class="p-4 flex flex-col items-center justify-center min-h-[60vh] pb-12">
            <div id="quoteDisplay" class="text-center max-w-2xl">
                <p id="quoteText" class="text-2xl md:text-3xl font-medium leading-relaxed mb-6"></p>
                <p id="quoteAuthor" class="text-purple-300 text-lg"></p>
            </div>
            <div class="flex gap-4 mt-8">
                <button onclick="speakQuote()" class="pulse-btn bg-teal-600 hover:bg-teal-700 px-6 py-3 rounded-full font-medium" id="listenQuoteBtn">ğŸ”Š Ø§Ø³ØªÙ…Ø¹</button>
                <button onclick="nextQuote()" class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-full font-medium" id="nextQuoteBtn">Ø§Ù‚ØªØ¨Ø§Ø³ Ø¬Ø¯ÙŠØ¯ â†»</button>
            </div>
        </div>
    </div>

    <!-- Relaxation Panel -->
    <div id="relaxPanel" class="floating-panel fixed z-40 bg-gray-900/98 backdrop-blur-2xl overflow-y-auto">
        <div class="p-5 border-b border-green-500/30 flex justify-between items-center sticky top-0 bg-gray-900/98 z-10 rounded-t-3xl">
            <h3 class="text-xl font-bold" id="relaxTitle">ğŸ§˜ ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡</h3>
            <button onclick="closePanel('relax')" class="text-3xl font-bold w-10 h-10 flex items-center justify-center rounded-full bg-white/10 hover:bg-white/20 transition-colors">âœ•</button>
        </div>
        <div id="relaxContent" class="p-4 space-y-4 pb-12"></div>
    </div>

    <!-- Stories Panel -->
    <div id="storiesPanel" class="floating-panel fixed z-40 bg-gray-900/98 backdrop-blur-2xl overflow-y-auto">
        <div class="p-5 border-b border-amber-500/30 flex justify-between items-center sticky top-0 bg-gray-900/98 z-10 rounded-t-3xl">
            <h3 class="text-xl font-bold" id="storiesTitle">ğŸ“– Ù‚ØµØµ Ø§Ù„Ù†ÙˆÙ…</h3>
            <button onclick="closePanel('stories')" class="text-3xl font-bold w-10 h-10 flex items-center justify-center rounded-full bg-white/10 hover:bg-white/20 transition-colors">âœ•</button>
        </div>
        <div id="storiesContent" class="p-4 pb-12"></div>
    </div>

    <!-- Music Panel -->
    <div id="musicPanel" class="floating-panel fixed z-40 bg-gray-900/98 backdrop-blur-2xl overflow-y-auto">
        <div class="p-5 border-b border-blue-500/30 flex justify-between items-center sticky top-0 bg-gray-900/98 z-10 rounded-t-3xl">
            <h3 class="text-xl font-bold" id="musicTitle">ğŸµ Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ù‡Ø§Ø¯Ø¦Ø©</h3>
            <button onclick="closePanel('music')" class="text-3xl font-bold w-10 h-10 flex items-center justify-center rounded-full bg-white/10 hover:bg-white/20 transition-colors">âœ•</button>
        </div>
        <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4 pb-12" id="musicContent"></div>
    </div>

    <!-- Footer -->
    <footer class="fixed bottom-0 left-0 right-0 z-50 bg-gradient-to-t from-black/90 to-transparent p-4 backdrop-blur-sm">
        <div class="flex justify-center items-center gap-4 md:gap-8 max-w-2xl mx-auto">
            <a href="https://instagram.com/_itlulp" target="_blank" class="text-pink-400 hover:text-pink-300 flex items-center gap-2 text-sm">
                <span>ğŸ“¸</span> @_itlulp
            </a>
            <span class="text-gray-500">|</span>
            <button id="soundToggle" class="menu-btn bg-purple-600/80 hover:bg-purple-700 p-2 rounded-full text-xl shadow-lg">
                ğŸ”Š
            </button>
            <span class="text-gray-500">|</span>
            <span id="visitorCount" class="text-purple-300 text-sm">ğŸ‘¥ <span id="visitors">0</span></span>
            <span class="text-gray-500">|</span>
            <button onclick="showAdminLogin()" class="text-2xl hover:scale-110 transition-transform">ğŸ”’</button>
        </div>
    </footer>

    <!-- Admin Panel -->
    <div id="adminModal" class="hidden fixed inset-0 z-60 bg-black/90 flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-2xl p-6 max-w-md w-full">
            <div id="adminLogin">
                <h3 class="text-xl font-bold mb-4 text-center">ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù</h3>
                <input type="password" id="adminPassword" class="w-full bg-gray-700 rounded-lg px-4 py-3 mb-4 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ">
                <div class="flex gap-2">
                    <button onclick="checkAdmin()" class="flex-1 bg-purple-600 hover:bg-purple-700 py-3 rounded-lg font-medium">Ø¯Ø®ÙˆÙ„</button>
                    <button onclick="closeAdmin()" class="flex-1 bg-gray-600 hover:bg-gray-700 py-3 rounded-lg font-medium">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>
            <div id="adminDashboard" class="hidden">
                <h3 class="text-xl font-bold mb-4 text-center">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
                <div class="space-y-4">
                    <div class="bg-gray-700 rounded-lg p-4">
                        <div class="text-purple-300 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙˆØ§Ø± Ø§Ù„ÙƒÙ„ÙŠ</div>
                        <div class="text-3xl font-bold" id="adminVisitors">0</div>
                    </div>
                    <div class="bg-gray-700 rounded-lg p-4">
                        <div class="text-purple-300 mb-2">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©</div>
                        <div id="adminMessages" class="max-h-40 overflow-y-auto space-y-2"></div>
                    </div>
                </div>
                <button onclick="closeAdmin()" class="w-full mt-4 bg-gray-600 hover:bg-gray-700 py-3 rounded-lg font-medium">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <script>
        // Language System
        let currentLang = 'ar';
        const translations = {
            ar: {
                siteTitle: 'âœ¨ Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù† âœ¨',
                welcomeTitle: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù†',
                welcomeDesc: 'Ù…ÙƒØ§Ù†Ùƒ Ù„Ù„Ø±Ø§Ø­Ø© ÙˆØ§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡ ÙˆØ§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù† Ø¶ØºÙˆØ· Ø§Ù„Ø­ÙŠØ§Ø©',
                menuChat: 'Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©', menuGames: 'Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨', menuQuotes: 'Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª',
                menuRelax: 'ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡', menuStories: 'Ù‚ØµØµ Ø§Ù„Ù†ÙˆÙ…', menuMusic: 'Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ù‡Ø§Ø¯Ø¦Ø©',
                chatTitle: 'ğŸ’¬ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©', gamesTitle: 'ğŸ® Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©',
                quotesTitle: 'ğŸ’­ Ø§Ù‚ØªØ¨Ø§Ø³ Ø§Ù„ÙŠÙˆÙ…', relaxTitle: 'ğŸ§˜ ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡',
                storiesTitle: 'ğŸ“– Ù‚ØµØµ Ø§Ù„Ù†ÙˆÙ…', musicTitle: 'ğŸµ Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ù‡Ø§Ø¯Ø¦Ø©',
                sendBtn: 'Ø¥Ø±Ø³Ø§Ù„', listenQuoteBtn: 'ğŸ”Š Ø§Ø³ØªÙ…Ø¹', nextQuoteBtn: 'Ø§Ù‚ØªØ¨Ø§Ø³ Ø¬Ø¯ÙŠØ¯ â†»',
                langText: 'English', placeholder: 'Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...'
            },
            en: {
                siteTitle: 'âœ¨ Your Safe Haven âœ¨',
                welcomeTitle: 'Welcome to Your Safe Haven',
                welcomeDesc: 'Your place for rest, relaxation, and escape from life\'s pressures',
                menuChat: 'Chat', menuGames: 'Games', menuQuotes: 'Quotes',
                menuRelax: 'Relaxation', menuStories: 'Sleep Stories', menuMusic: 'Calm Music',
                chatTitle: 'ğŸ’¬ Chat', gamesTitle: 'ğŸ® Daily Games',
                quotesTitle: 'ğŸ’­ Quote of the Day', relaxTitle: 'ğŸ§˜ Relaxation Exercises',
                storiesTitle: 'ğŸ“– Sleep Stories', musicTitle: 'ğŸµ Calm Music',
                sendBtn: 'Send', listenQuoteBtn: 'ğŸ”Š Listen', nextQuoteBtn: 'New Quote â†»',
                langText: 'Ø¹Ø±Ø¨ÙŠ', placeholder: 'Type your message...'
            }
        };

        function toggleLanguage() {
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            document.documentElement.lang = currentLang;
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            
            const t = translations[currentLang];
            for (let key in t) {
                const el = document.getElementById(key);
                if (el) el.textContent = t[key];
            }
            document.getElementById('chatInput').placeholder = t.placeholder;
            loadContent();
        }
        document.getElementById('langToggle').onclick = toggleLanguage;

        // Stars Animation
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                starsContainer.appendChild(star);
            }
        }
        createStars();

        // Sound System (Daily + Refresh rotating YouTube background track)
        let soundEnabled = false;

        const bgMusicPool = [
            // Ù…Ù‚Ø§Ø·Ø¹ ÙŠÙˆØªÙŠÙˆØ¨ Ù‡Ø§Ø¯Ø¦Ø© Ù…Ù† Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            { id: 'lwvMcvzEITI', titleAr: 'Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ù‡Ø§Ø¯Ø¦Ø© Ù„Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡', titleEn: 'Calm Relaxing Music' },
            { id: 'iFyBF70I2fc', titleAr: 'Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ù„Ù„Ù†ÙˆÙ… Ø§Ù„Ø¹Ù…ÙŠÙ‚', titleEn: 'Deep Sleep Music' },
            { id: '2AH5t_o7lmg', titleAr: 'Ø£ØµÙˆØ§Øª Ø§Ù„Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ù‡Ø§Ø¯Ø¦Ø©', titleEn: 'Peaceful Nature Sounds' },
            { id: 'zcLv6aZBFdY', titleAr: 'Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ø³ØªØ±Ø®Ø§Ø¡ ÙˆØªØ£Ù…Ù„', titleEn: 'Relaxation & Meditation' }
        ];

        function getDayOfYear() {
            const now = new Date();
            const start = new Date(now.getFullYear(), 0, 0);
            const diff = now - start;
            return Math.floor(diff / (1000 * 60 * 60 * 24));
        }

        function buildBgMusicUrl(id) {
            // Background audio: use JS API flags and cache-busting to reduce stale loads.
            // Note: true autoplay-with-sound is blocked by browsers until user gesture.
            const base = `https://www.youtube.com/embed/${id}`;
            const params = new URLSearchParams({
                autoplay: '1',
                loop: '1',
                playlist: id,
                controls: '0',
                rel: '0',
                modestbranding: '1',
                playsinline: '1',
                enablejsapi: '1',
                // Improve reliability:
                origin: location.origin,
                mute: '0',
                // Cache-buster so refresh reliably reloads the chosen daily/refresh track
                t: String(Date.now())
            });
            return `${base}?${params.toString()}`;
        }

        function tryStartBgMusic() {
            // Re-apply src when user gesture happens to satisfy browser autoplay policies
            if (!soundEnabled) return;
            setBgMusicTrack(currentBgTrack);
        }

        function pickBgTrackForThisLoad() {
            const day = getDayOfYear();
            const r = Math.floor(Math.random() * bgMusicPool.length);
            const idx = (day + r) % bgMusicPool.length;
            return bgMusicPool[idx];
        }

        // Chosen once per page load (refresh changes it)
        let currentBgTrack = pickBgTrackForThisLoad();

        function setBgMusicTrack(track) {
            const iframe = document.getElementById('bgMusic');
            // Clear first to force reload even when selecting same ID again
            iframe.src = '';
            if (track) {
                // small delay helps some browsers apply the new src reliably
                setTimeout(() => {
                    iframe.src = buildBgMusicUrl(track.id);
                }, 50);
            }
        }

        function enableSound() {
            if (!soundEnabled) {
                soundEnabled = true;
                document.getElementById('soundToggle').textContent = 'ğŸ”Š';
            }
            // Always try to start on any user gesture (some browsers need re-trigger)
            tryStartBgMusic();
        }

        // Autoplay with sound is usually blocked; we start on the first user interaction.
        // We listen to multiple events to maximize reliability.
        ['pointerdown','click','touchstart','keydown'].forEach(evt => {
            document.addEventListener(evt, enableSound, { once: true, passive: true });
        });

        // Also try when the tab becomes visible again
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) tryStartBgMusic();
        });

        document.getElementById('soundToggle').onclick = function() {
            soundEnabled = !soundEnabled;
            this.textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
            if (soundEnabled) {
                tryStartBgMusic();
            } else {
                setBgMusicTrack(null);
            }
        };

        // Panel System
        function toggleMenu() {
            const menu = document.getElementById('sideMenu');
            const isHidden = menu.classList.contains('translate-x-full');
            menu.classList.toggle('translate-x-full', !isHidden);
            menu.classList.toggle('translate-x-0', isHidden);
        }

        function openPanel(name) {
            const panel = document.getElementById(name + 'Panel');
            const backdrop = document.getElementById('panelBackdrop');
            panel.classList.add('active');
            backdrop.classList.add('active');
        }
        function closePanel(name) {
            const panel = document.getElementById(name + 'Panel');
            const backdrop = document.getElementById('panelBackdrop');
            panel.classList.remove('active');
            // Check if any other panels are active before hiding backdrop
            const activePanels = document.querySelectorAll('.floating-panel.active');
            if (activePanels.length <= 1) {
                backdrop.classList.remove('active');
            }
        }
        function closeAllPanels() {
            const panels = document.querySelectorAll('.floating-panel');
            const backdrop = document.getElementById('panelBackdrop');
            const menu = document.getElementById('sideMenu');
            
            panels.forEach(p => p.classList.remove('active'));
            backdrop.classList.remove('active');
            
            // Also close menu if open
            if (menu.classList.contains('translate-x-0')) {
                toggleMenu();
            }
        }

        // Chat System - Advanced Saudi Dialect + English (ChatGPT-like)
        // NOTE: This is a local, rule-based system (no external API). It aims to feel like ChatGPT:
        // - Understand sentence-level intent (not only keywords)
        // - Keep a short-term "topic/mood" memory across turns
        // - Respond naturally with follow-up questions

        const chatPatterns = {
            // Arabic patterns
            ar: [
                { pattern: /(Ù…Ø±Ø­Ø¨Ø§|Ø§Ù‡Ù„Ø§|Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…|Ù‡Ù„Ø§)/i, response: 'Ù‡Ù„Ø§ ÙˆØ§Ù„Ù„Ù‡! ÙˆØ´ Ø£Ø®Ø¨Ø§Ø±Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ' },
                { pattern: /(ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ|ÙƒÙŠÙÙƒ|Ø´Ø®Ø¨Ø§Ø±Ùƒ|Ø£Ø®Ø¨Ø§Ø±Ùƒ)/i, response: 'Ø§Ù„Ø­Ù…Ø¯Ù„Ù„Ù‡ ØªÙ…Ø§Ù…ØŒ ÙˆØ§Ù†Øª ÙƒÙŠÙÙƒØŸ' },
                { pattern: /(Ø´ÙƒØ±Ø§|ÙŠØ¹Ø·ÙŠÙƒ Ø§Ù„Ø¹Ø§ÙÙŠØ©|Ù…Ø´ÙƒÙˆØ±|ØªØ³Ù„Ù…)/i, response: 'Ø§Ù„Ø¹ÙÙˆØŒ Ø­ÙŠØ§Ùƒ Ø¨Ø£ÙŠ ÙˆÙ‚Øª.' },
                { pattern: /(ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±|Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±)/i, response: 'ÙŠØ§ Ù‡Ù„Ø§! ØµØ¨Ø§Ø­/Ù…Ø³Ø§Ø¡ Ø§Ù„Ù†ÙˆØ±.' },
                { pattern: /(ÙˆØ¯Ø§Ø¹Ø§|Ø¨Ø§Ù‰|Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø©)/i, response: 'Ø§Ù„Ù„Ù‡ ÙŠØ­ÙØ¸Ùƒâ€¦ ÙˆØ¥Ø°Ø§ Ø§Ø­ØªØ¬ØªÙ†ÙŠ Ø§Ø±Ø¬Ø¹ Ø¨Ø£ÙŠ ÙˆÙ‚Øª.' }
            ],
            // English patterns
            en: [
                { pattern: /(hello|hi|hey)/i, response: 'Hey! How are you doing today?' },
                { pattern: /(how are you|how do you do)/i, response: 'Iâ€™m goodâ€”thanks for asking. How about you?' },
                { pattern: /(thank you|thanks|appreciate|thx)/i, response: 'Anytime. Iâ€™m here for you.' },
                { pattern: /(good morning|good evening|good night)/i, response: 'Good morning/evening/night. Howâ€™s your day going?' },
                { pattern: /(bye|goodbye|see you)/i, response: 'Take care. Iâ€™m here whenever you need.' }
            ]
        };

        // Advanced ChatGPT-like response system
        let chatHistory = [];
        const maxHistory = 40;

        // Lightweight user profile (local, optional)
        let userProfile = (() => {
            try { return JSON.parse(localStorage.getItem('userProfile') || '{}') || {}; }
            catch { return {}; }
        })();
        function saveUserProfile() {
            try { localStorage.setItem('userProfile', JSON.stringify(userProfile)); } catch {}
        }

        // Persistent chat "state" (mood/topic) to make replies feel coherent across turns
        let chatState = (() => {
            try {
                return JSON.parse(localStorage.getItem('chatState') || '{}') || {};
            } catch {
                return {};
            }
        })();
        function saveChatState() {
            try { localStorage.setItem('chatState', JSON.stringify(chatState)); } catch {}
        }

        function getRandom(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function detectLangFromText(text) {
            const hasArabic = /[Ø£-ÙŠ]/.test(text);
            const hasLatin = /[A-Za-z]/.test(text);
            if (hasArabic && !hasLatin) return 'ar';
            if (hasLatin && !hasArabic) return 'en';
            return currentLang === 'ar' ? 'ar' : 'en';
        }

        function normalizeForMatch(s) {
            return (s || '')
                .toLowerCase()
                .replace(/[\u064B-\u0652]/g, '')
                .replace(/Ù€/g, '')
                .trim();
        }

        function arabicDigitsToLatin(str) {
            return (str || '')
                .replace(/[Ù -Ù©]/g, d => 'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'.indexOf(d))
                .replace(/[Û°-Û¹]/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'.indexOf(d));
        }

        function safeEvalMath(expr) {
            const cleaned = arabicDigitsToLatin(expr)
                .replace(/Ã—/g, '*')
                .replace(/Ã·/g, '/')
                .replace(/,/g, '.')
                .trim();

            if (!cleaned) return null;
            if (!/^[0-9+\-*/().\s]+$/.test(cleaned)) return null;
            if (/([+\-*/])\1{1,}/.test(cleaned)) return null;

            try {
                // eslint-disable-next-line no-new-func
                const val = Function('"use strict"; return (' + cleaned + ')')();
                if (typeof val !== 'number' || !isFinite(val)) return null;
                return val;
            } catch {
                return null;
            }
        }

        function pickQuoteForChat(lang) {
            const quotes = lang === 'ar' ? quotesAr : quotesEn;
            const q = quotes[Math.floor(Math.random() * quotes.length)];
            return `"${q.text}" â€” ${q.author}`;
        }

        function updateState(partial) {
            chatState = {
                ...chatState,
                ...partial,
                _ts: Date.now()
            };
            saveChatState();
        }

        function getState() {
            const ts = chatState && chatState._ts ? chatState._ts : 0;
            if (ts && (Date.now() - ts) > 1000 * 60 * 25) {
                chatState = {};
                saveChatState();
            }
            return chatState || {};
        }

        function detectIntentAndMood(raw, lang) {
            const isArabic = lang === 'ar';
            const text = normalizeForMatch(raw);

            const intents = {
                sleep: isArabic
                    ? /(Ù…Ø§\s*Ø§Ù‚Ø¯Ø±\s*Ø§Ù†Ø§Ù…|Ù…Ù‚Ø¯Ø±Øª\s*Ø§Ù†Ø§Ù…|Ù…Ø¨\s*Ù‚Ø§Ø¯Ø±\s*Ø§Ù†Ø§Ù…|Ù…Ø§\s*Ø¬Ø§Ù†ÙŠ\s*Ù†ÙˆÙ…|Ø§Ø¨ÙŠ\s*Ø§Ù†Ø§Ù…|Ø§Ø¨ØºÙ‰\s*Ø§Ù†Ø§Ù…|Ø³Ù‡Ø±Ø§Ù†|Ø³Ù‡Ø±|Ø§Ø±?Ù‚|Ø£Ø±Ù‚|Ù†ÙˆÙ…ÙŠ\s*Ø®Ø±Ø¨Ø§Ù†|Ù†ÙˆÙ…\s*Ù…ØªÙ‚Ø·Ø¹|Ù‚Ù„Ù‚\s*Ù‚Ø¨Ù„\s*Ø§Ù„Ù†ÙˆÙ…)/i.test(raw)
                    : /(can't\s*sleep|cannot\s*sleep|insomnia|trouble\s*sleeping|sleep\s*is\s*bad|sleep\s*schedule|sleep\s*deprived)/i.test(raw),

                exams: isArabic
                    ? /(Ø§Ø®ØªØ¨Ø§Ø±|Ø§Ù…ØªØ­Ø§Ù†|ÙØ§ÙŠÙ†Ù„|Ù†Ù‡Ø§Ø¦ÙŠ|Ù‚Ø¯Ø±Ø§Øª|ØªØ­ØµÙŠÙ„ÙŠ|Ù…Ø°Ø§ÙƒØ±Ø©|Ù…Ø±Ø§Ø¬Ø¹Ø©|ÙˆØ§Ø¬Ø¨|Ù…Ø´Ø±ÙˆØ¹|ØªØ³Ù„ÙŠÙ…|Ø¯Ø±Ø¬Ø§Øª|Ù…Ø¯Ø±Ø³Ø©|Ø¬Ø§Ù…Ø¹Ø©)/i.test(raw)
                    : /(exam|exams|test|finals|quiz|study|studying|homework|assignment|deadline|grades|school|college|university)/i.test(raw),

                relationship: isArabic
                    ? /(Ø­Ø¨ÙŠØ¨|Ø­Ø¨ÙŠØ¨ÙŠ|Ø­Ø¨ÙŠØ¨ØªÙŠ|Ø¹Ù„Ø§Ù‚ØªÙŠ|Ø§Ø±ØªØ¨Ø§Ø·|Ø®Ø·ÙŠØ¨|Ø®Ø·ÙˆØ¨Ø©|Ø²ÙˆØ¬ÙŠ|Ø²ÙˆØ¬ØªÙŠ|Ø§Ù†ÙØµØ§Ù„|ÙØ±Ø§Ù‚|Ø®ÙŠØ§Ù†Ø©|ØºÙŠØ±Ø©|Ù…Ø´Ø§Ø¹Ø±|Ø­Ø¨)/i.test(raw)
                    : /(boyfriend|girlfriend|partner|relationship|dating|breakup|cheating|jealous|feelings|love)/i.test(raw),

                longing: isArabic
                    ? /(Ø§Ø´ØªÙ‚Øª|Ø´ÙˆÙ‚|ÙˆØ­Ø´ØªÙ†ÙŠ|ÙˆØ­Ø´Ù†ÙŠ|Ø£ÙØªÙ‚Ø¯|Ø§ÙØªÙ‚Ø¯|Ø­Ù†ÙŠØª|Ø­Ù†ÙŠÙ†)/i.test(raw)
                    : /(miss\s+you|i\s*miss|longing|nostalgia|i\s*miss\s*them)/i.test(raw),

                joke: isArabic
                    ? /(Ù†ÙƒØªØ©|Ù†ÙƒØª|Ø¶Ø­ÙƒÙ†ÙŠ|Ù…Ø²Ø­|Ø·Ù‚Ø·Ù‚Ø©)/i.test(raw)
                    : /(joke|funny|make\s*me\s*laugh|lol|roast)/i.test(raw),

                question: isArabic
                    ? /\?|ØŸ|Ù„ÙŠØ´|Ù„Ù…Ø§Ø°Ø§|ÙƒÙŠÙ|Ù…ØªÙ‰|ÙˆÙŠÙ†|Ø§ÙŠØ´|ÙˆØ´|Ù‡Ù„\s+/i.test(raw)
                    : /\?|\bhow\b|\bwhy\b|\bwhen\b|\bwhere\b|\bwhat\b|\bwho\b|\bcan\b\s+you|\bcould\b\s+you|\bshould\b\s+i/i.test(text),

                compliment: isArabic
                    ? /(ÙƒÙÙˆ|Ù…Ù…ØªØ§Ø²|Ø±Ù‡ÙŠØ¨|Ø¬Ù…ÙŠÙ„|Ø­Ù„Ùˆ|Ø§Ø¨Ø¯Ø¹Øª|Ù…Ø¨Ø¯Ø¹|Ø£Ø­Ø³Ù†Øª)/i.test(raw)
                    : /(awesome|great|amazing|nice|good job|well done)/i.test(text)
            };

            const moods = {
                sad: isArabic
                    ? /(Ø­Ø²ÙŠÙ†|Ø²Ø¹Ù„Ø§Ù†|Ù…ÙƒØªØ¦Ø¨|Ø¶Ø§ÙŠÙ‚|Ù…Ø¶Ø§ÙŠÙ‚|Ù…Ù‡Ù…ÙˆÙ…|Ù…Ù‚Ù‡ÙˆØ±|ÙˆØ­ÙŠØ¯|ÙˆØ­Ø¯Ù‡|ØªØ¹Ø¨Ø§Ù†\s*Ù†ÙØ³ÙŠØ§|Ø·ÙØ´Ø§Ù†)/i.test(raw)
                    : /(sad|depressed|down|upset|lonely|heartbroken|miserable)/i.test(text),

                happy: isArabic
                    ? /(Ù…Ø¨Ø³ÙˆØ·|ÙØ±Ø­Ø§Ù†|Ø³Ø¹ÙŠØ¯|Ù…ØªØ­Ù…Ø³|Ù…ØªÙØ§Ø¦Ù„|ÙØ®ÙˆØ±|Ø§Ù†Ø¬Ø§Ø²|Ù†Ø¬Ø­Øª|ØªØ±Ù‚ÙŠÙ‡|Ù†Ø¬Ø§Ø­)/i.test(raw)
                    : /(happy|excited|great|awesome|proud|achievement|i\s*did\s*it|i\s*passed)/i.test(text),

                anxious: isArabic
                    ? /(Ù‚Ù„Ù‚Ø§Ù†|Ù…ØªÙˆØªØ±|ØªÙˆØªØ±|Ù‚Ù„Ù‚|Ø®Ø§ÙŠÙ|Ù…Ø±ØªØ¨Ùƒ|Ù…Ø¶ØºÙˆØ·|Ø¶ØºØ·|panik)/i.test(raw)
                    : /(anxious|stressed|worried|nervous|overwhelmed|panic)/i.test(text),

                romantic: isArabic
                    ? /(Ø§Ø­Ø¨|Ø­Ø¨ÙŠØª|Ø§Ø¹Ø´Ù‚|ÙˆÙ„Ù‡Ø§Ù†|Ù…ØºØ±Ù…|Ù‚Ù„Ø¨ÙŠ|ØºØ±Ø§Ù…)/i.test(raw)
                    : /(love|crush|in\s*love|romantic)/i.test(text),

                playful: isArabic
                    ? /(Ù‡Ù‡Ù‡Ù‡|ğŸ˜‚|ğŸ˜…|lol|ÙŠÙ…Ø²Ø­|ÙÙ„Ù‡)/i.test(raw)
                    : /(lol|lmao|haha|ğŸ˜‚|ğŸ˜…)/i.test(raw)
            };

            const mood = moods.sad ? 'sad'
                : moods.anxious ? 'anxious'
                : moods.happy ? 'happy'
                : moods.romantic ? 'romantic'
                : moods.playful ? 'playful'
                : null;

            const topic = intents.sleep ? 'sleep'
                : intents.exams ? 'exams'
                : intents.relationship ? 'relationship'
                : intents.longing ? 'longing'
                : intents.joke ? 'jokes'
                : null;

            return { intents, mood, topic };
        }

        function getAIResponse(msg) {
            const lang = detectLangFromText(msg);
            const isArabic = lang === 'ar';
            const raw = (msg || '').trim();
            const text = normalizeForMatch(raw);
            
            // Add to history
            chatHistory.push({ role: 'user', content: raw, lang });
            if (chatHistory.length > maxHistory) chatHistory.shift();

            // Helpers & Detection
            const hasThanks = /(Ø´ÙƒØ±Ø§|Ø´ÙƒØ±Ù‹Ø§|ÙŠØ¹Ø·ÙŠÙƒ Ø§Ù„Ø¹Ø§ÙÙŠØ©|Ù…Ø´ÙƒÙˆØ±|ØªØ³Ù„Ù…|Ø¬Ø²Ø§Ùƒ Ø§Ù„Ù„Ù‡ Ø®ÙŠØ±|thank you|thanks|thx)/i.test(raw);
            const wantsJoke = /(Ù†ÙƒØªØ©|Ù†ÙƒØª|Ø¶Ø­ÙƒÙ†ÙŠ|Ù…Ø²Ø­|Ø·Ù‚Ø·Ù‚Ø©|joke|funny|roast)/i.test(raw);
            const isPhilosophy = /(Ø­ÙŠØ§Ø©|Ù…ÙˆØª|ÙˆØ¬ÙˆØ¯|ÙÙ„Ø³ÙØ©|Ù…Ø¹Ù†Ù‰|Ù‚Ø¯Ø±|Ù…ØµÙŠØ±|life|death|meaning|exist|purpose)/i.test(raw);
            const isWeird = /(ØºØ±ÙŠØ¨|ØªØ®ÙŠÙ„|Ù„Ùˆ|ÙØ¶Ø§Ø¦ÙŠ|alien|weird|imagine|if|zombie)/i.test(raw);
            const isGreeting = /(Ù…Ø±Ø­Ø¨Ø§|Ø§Ù‡Ù„Ø§|Ù‡Ù„Ø§|Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…|ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±|Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±|hello|hi|hey)/i.test(raw);
            const isHowAreYou = /(ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ|ÙƒÙŠÙÙƒ|Ø´Ø®Ø¨Ø§Ø±Ùƒ|Ø£Ø®Ø¨Ø§Ø±Ùƒ|how are you|how do you do)/i.test(raw);
            const wantsAdvice = /(Ù†ØµÙŠØ­Ø©|Ø³Ø§Ø¹Ø¯Ù†ÙŠ|ÙˆØ´ Ø§Ø³ÙˆÙŠ|Ø§ÙŠØ´ Ø§Ø³ÙˆÙŠ|ÙƒÙŠÙ Ø§ØªØµØ±Ù|advice|help)/i.test(raw);

            // User Profile
            if (isArabic) {
                const m = raw.match(/^(Ø§Ø³Ù…ÙŠ|Ø£Ù†Ø§ Ø§Ø³Ù…ÙŠ|Ø§Ù†Ø§ Ø§Ø³Ù…ÙŠ)\s+([\p{L}A-Za-z0-9_\-]{2,20})/u);
                if (m) { userProfile.name = m[2]; saveUserProfile(); }
            } else {
                const m = raw.match(/^(my name is|i\s*am|i'm)\s+([A-Za-z][A-Za-z\-']{1,20})/i);
                if (m) { userProfile.name = m[2]; saveUserProfile(); }
            }
            const nameSuffix = userProfile.name ? (isArabic ? ` ÙŠØ§ ${userProfile.name}` : `, ${userProfile.name}`) : '';

            // 1. Safety (Self-Harm) - Priority #1
            const selfHarm = /(Ø§Ù†ØªØ­Ø§Ø±|Ø§Ø¨ÙŠ\s*Ø§Ù…ÙˆØª|ÙˆØ¯ÙŠ\s*Ø§Ù…ÙˆØª|Ù…Ø§\s*Ø§Ø¨ÙŠ\s*Ø§Ø¹ÙŠØ´|Ø£Ø°[ÙŠÙ‰]\s*Ù†ÙØ³ÙŠ|suicide|kill\s*myself)/i;
            if (selfHarm.test(raw)) {
                return isArabic 
                    ? 'Ø£Ù†Ø§ Ø£Ø³Ù…Ø¹ÙƒØŒ ÙˆÙ‚Ù„Ø¨ÙŠ Ù…Ø¹Ùƒ. Ø£Ù†Øª Ù„Ø³Øª ÙˆØ­Ø¯Ùƒ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø£Ù„Ù…. Ø£Ø±Ø¬ÙˆÙƒØŒ Ø¥Ø°Ø§ ÙƒÙ†Øª ÙÙŠ Ø®Ø·Ø± Ø§Ù„Ø¢Ù†ØŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø´Ø®Øµ ØªØ«Ù‚ Ø¨Ù‡ Ø£Ùˆ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙÙˆØ±Ø§Ù‹. Ø­ÙŠØ§ØªÙƒ Ù„Ù‡Ø§ Ù‚ÙŠÙ…Ø© ÙƒØ¨ÙŠØ±Ø©ØŒ Ø­ØªÙ‰ Ù„Ùˆ ØºØ§Ø¨Øª Ø¹Ù†Ùƒ Ø§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø¢Ù†.' 
                    : 'I hear you, and I care. You are not alone. Please, if you are in danger, reach out to someone you trust or emergency services immediately. Your life matters.';
            }

            // 2. Math
            const mathVal = safeEvalMath(raw);
            if (mathVal !== null && /[0-9]/.test(raw) && /[+\-*/]/.test(raw)) {
                return isArabic ? `Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù‡ÙŠ: ${mathVal}` : `The result is: ${mathVal}`;
            }

            // 3. Jokes
            if (wantsJoke) {
                const jokes = isArabic ? [
                    'ÙˆØ§Ø­Ø¯ Ù‚Ø§Ù„ Ù„Ø£Ø¨ÙˆÙ‡: ÙŠØ¨Ù‡ Ø±Ø®ØµØªÙŠ Ø§Ù†ØªÙ‡Øª.. Ù‚Ø§Ù„ Ù„Ù‡: Ø¥ÙŠ ÙˆØ§Ù„Ù„Ù‡ Ù…Ù† ÙƒØ«Ø± Ù…Ø§ ØªÙ„Ù ÙˆØªØ¯ÙˆØ± Ø¨Ø§Ù„Ø´ÙˆØ§Ø±Ø¹.',
                    'Ù…Ø­Ø´Ø´ Ø±Ø§Ø­ ÙŠØ®Ø·Ø¨ Ù‚Ø§Ù„ÙˆØ§ Ù„Ù‡ Ø§Ù„Ø¨Ù†Øª ØªØ¯Ø±Ø³.. Ù‚Ø§Ù„: Ø®Ù„Ø§Øµ Ø£Ø¬ÙŠ Ø¨Ø§Ù„ÙØ³Ø­Ø©.',
                    'Ù†Ø°Ù„ Ø´Ø§Ù ÙˆØ§Ø­Ø¯ ÙŠØºØ±Ù‚ ÙˆÙŠÙ‚ÙˆÙ„: Ø£Ù†Ù‚Ø°ÙˆÙ†ÙŠ! Ù‚Ø§Ù„Ù‡: ÙŠØ§ Ø£Ø®ÙŠ Ù…Ø§ ÙŠØµÙŠØ± ØªØ·Ù„Ø¨ ÙˆØ§Ù†Øª ØªØ³Ø¨Ø­ØŒ Ø¹ÙŠØ¨.',
                    'ÙˆØ§Ø­Ø¯ Ø¨Ø®ÙŠÙ„ Ø§Ø´ØªØ±Ù‰ Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø©ØŒ Ø´Ø§Ù„ Ø§Ù„ØµÙØ± Ø¹Ø´Ø§Ù† ÙŠÙˆÙØ±.',
                    'ÙˆØ§Ø­Ø¯ Ø³Ø£Ù„ Ù…Ø­Ø´Ø´: ÙˆØ´ Ø§Ø³Ù…ÙƒØŸ Ù‚Ø§Ù„: Ù…Ø§ Ø£Ø¯Ø±ÙŠ Ø¨Ø³ ÙŠÙ†Ø§Ø¯ÙˆÙ†ÙŠ Ø¨Ø³Ø±Ø¹Ø© ØªØ¹Ø§Ù„.'
                ] : [
                    'Why donâ€™t scientists trust atoms? Because they make up everything.',
                    'What do you call a fake noodle? An Impasta.',
                    'Why did the scarecrow win an award? Because he was outstanding in his field.',
                    'Parallel lines have so much in common. Itâ€™s a shame theyâ€™ll never meet.'
                ];
                return getRandom(jokes);
            }

            // 4. Philosophy
            if (isPhilosophy) {
                return isArabic 
                    ? `Ù‡Ø°Ø§ Ø³Ø¤Ø§Ù„ Ø¹Ù…ÙŠÙ‚${nameSuffix}. Ø§Ù„Ø­ÙŠØ§Ø© Ø±Ø­Ù„Ø© Ù…Ù† Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹Ù†Ù‰ØŒ ÙˆØ£Ø­ÙŠØ§Ù†Ø§Ù‹ Ø§Ù„Ù…Ø¹Ù†Ù‰ ÙŠÙƒÙ…Ù† ÙÙŠ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµØºÙŠØ±Ø©: ÙÙŠ Ø¶Ø­ÙƒØ©ØŒ ÙÙŠ Ù„Ø­Ø¸Ø© Ù‡Ø¯ÙˆØ¡ØŒ Ø£Ùˆ ÙÙŠ Ø§Ù„Ø¹Ø·Ø§Ø¡. ÙˆØ´ Ø±Ø£ÙŠÙƒ Ø£Ù†ØªØŸ` 
                    : `That is a deep question${nameSuffix}. Life is often about finding meaning in small momentsâ€”a laugh, silence, or giving. What do you think?`;
            }

            // 5. Weird / Imagination
            if (isWeird) {
                return isArabic 
                    ? `Ø®ÙŠØ§Ù„ÙŠ ÙˆØ§Ø³Ø¹ Ø¬Ø¯Ø§Ù‹! ØªØ®ÙŠÙ„ Ù„Ùˆ ÙØ¹Ù„Ø§Ù‹ ØµØ§Ø± Ù‡Ø§Ù„Ø´ÙŠØŒ ÙƒØ§Ù† Ø§Ù„Ø¹Ø§Ù„Ù… ØªØºÙŠØ± ØªÙ…Ø§Ù…Ø§Ù‹. ÙƒÙ…Ù„ØŒ Ø£Ø­Ø¨ Ø´Ø·Ø­Ø§Øª Ø§Ù„Ø®ÙŠØ§Ù„ Ù‡Ø°ÙŠ.` 
                    : `That's wild! Imagine if that actually happened, the world would be so different. Go on, I love this kind of imagination.`;
            }

            // 6. Greetings & Well-being
            if (isGreeting) return isArabic ? `ÙŠØ§ Ù‡Ù„Ø§ ÙˆØ§Ù„Ù„Ù‡${nameSuffix}! Ù†ÙˆÙ‘Ø±Øª Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù†.` : `Hey there${nameSuffix}! Welcome to your safe haven.`;
            if (isHowAreYou) return isArabic ? `Ø£Ù†Ø§ Ø¨Ø®ÙŠØ± Ø¯Ø§Ù…Ù†ÙŠ Ø£Ø³Ù…Ø¹ Ù…Ù†Ùƒ. Ø·Ù…Ù†Ù‘ÙŠ Ø¹Ù†ÙƒØŒ ÙƒÙŠÙ Ø­Ø§Ù„ Ù‚Ù„Ø¨Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ` : `I'm doing great, happy to hear from you. How is your heart doing today?`;
            if (hasThanks) return isArabic ? `Ø§Ù„Ø¹ÙÙˆ ÙŠØ§ ØºØ§Ù„ÙŠØŒ Ø£Ù†Ø§ Ù…ÙˆØ¬ÙˆØ¯ Ø¹Ø´Ø§Ù†Ùƒ Ø¨Ø£ÙŠ ÙˆÙ‚Øª.` : `Anytime, I'm here for you whenever you need.`;

            // 7. Contextual Analysis (Mood & Topic)
            const analysis = detectIntentAndMood(raw, lang);
            const mood = analysis.mood; 
            const topic = analysis.topic;

            // Handle Moods - Natural Flow (No Repetitive Questions)
            if (mood === 'sad') {
                return isArabic 
                    ? `Ø³Ù„Ø§Ù…Ø© Ù‚Ù„Ø¨Ùƒ${nameSuffix}. Ø£Ù†Ø§ Ù‡Ù†Ø§ Ø£Ø³Ù…Ø¹ÙƒØŒ Ø®Ø° Ø±Ø§Ø­ØªÙƒ ÙˆÙØ¶ÙØ¶ Ø¹Ù† ÙƒÙ„ Ø§Ù„Ù„ÙŠ Ø¨Ø¯Ø§Ø®Ù„Ùƒ. Ù„Ø§ ØªØ®Ø¨ÙŠ Ø´ÙŠØŒ Ø£Ù†Ø§ Ø¬Ù†Ø¨Ùƒ.` 
                    : `I'm so sorry you're feeling this way${nameSuffix}. I'm here listening. Please, let it all out. I'm with you.`;
            }
            if (mood === 'happy') {
                return isArabic 
                    ? `ÙŠØ§ Ø²ÙŠÙ† Ù‡Ø§Ù„Ø£Ø®Ø¨Ø§Ø±! Ø§Ù„Ù„Ù‡ ÙŠØ¯ÙŠÙ… Ø¹Ù„ÙŠÙƒ Ø§Ù„ÙØ±Ø­Ø© ÙŠØ§ Ø±Ø¨. Ø§Ø­ÙƒÙŠ Ù„ÙŠ Ø£ÙƒØ«Ø±ØŒ ÙˆØ´ Ø§Ù„Ù„ÙŠ Ø£Ø³Ø¹Ø¯Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ` 
                    : `That makes me so happy to hear! May this joy last. Tell me more, what made your day?`;
            }
            if (mood === 'romantic' || topic === 'relationship') {
                return isArabic 
                    ? `Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø¹Ø§Ù„Ù… ÙƒØ¨ÙŠØ± ÙˆÙ…Ø¹Ù‚Ø¯. Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ Ø§Ù„Ø­Ø¨ ÙŠØ¹Ø·ÙŠÙ†Ø§ Ù‚ÙˆØ©ØŒ ÙˆØ£Ø­ÙŠØ§Ù†Ø§Ù‹ ÙŠØ§Ø®Ø° Ù…Ù†Ù†Ø§. ÙƒÙŠÙ Ø´Ø¹ÙˆØ±Ùƒ ØªØ¬Ø§Ù‡ Ù‡Ø°Ø§ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø¢Ù†ØŸ` 
                    : `Feelings are complex. Love can give us strength or drain us. How do you feel about this person right now?`;
            }
            if (mood === 'anxious') {
                return isArabic 
                    ? `Ù‡Ø¯ÙŠ Ø¨Ø§Ù„Ùƒ${nameSuffix}. Ø®Ø° Ù†ÙØ³ Ø¹Ù…ÙŠÙ‚... Ø´Ù‡ÙŠÙ‚... Ø²ÙÙŠØ±. ÙƒÙ„ Ù…Ø´ÙƒÙ„Ø© ÙˆÙ„Ù‡Ø§ Ø­Ù„ØŒ Ù„Ø§ ØªØ´ÙŠÙ„ Ù‡Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø¢Ù†. ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ Ù…Ø®ÙˆÙÙƒØŸ` 
                    : `Take a deep breath${nameSuffix}. Inhale... Exhale. Everything has a solution. What is worrying you the most right now?`;
            }

            // Handle Topics
            if (topic === 'sleep') {
                return isArabic 
                    ? `Ø§Ù„Ù†ÙˆÙ… Ø³Ù„Ø·Ø§Ù†ØŒ Ù„ÙƒÙ† Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ Ø§Ù„Ø£ÙÙƒØ§Ø± ØªØ³Ø±Ù‚Ù‡. Ø­Ø§ÙˆÙ„ ØªØªØ±Ùƒ Ø§Ù„Ø¬ÙˆØ§Ù„ØŒ ÙˆØªØ®ÙŠÙ„ Ù…ÙƒØ§Ù† Ù‡Ø§Ø¯Ø¦ Ø¬Ø¯Ø§Ù‹. Ø¬Ø±Ø¨Øª ØªØ³Ù…Ø¹ ØµÙˆØª Ø§Ù„Ù…Ø·Ø± Ø§Ù„Ù„ÙŠ ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŸ` 
                    : `Sleep is precious. Try to put the phone away and visualize a calm place. Have you tried listening to the rain sounds here?`;
            }
            if (topic === 'exams' || topic === 'study') {
                return isArabic 
                    ? `Ø£Ø¯Ø±ÙŠ Ø§Ù„Ø¶ØºØ· ÙƒØ¨ÙŠØ±ØŒ Ù„ÙƒÙ†Ùƒ Ù‚Ø¯Ù‘Ù‡Ø§. Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„Ø´ÙŠ Ø§Ù„Ø³Ù‡Ù„ Ø¹Ø´Ø§Ù† ØªØªØ­Ù…Ø³ØŒ ÙˆØ®Ø° Ø¨Ø±ÙŠÙƒØ§Øª ØµØºÙŠØ±Ø©. Ù„Ø§ ØªÙ†Ø³Ù‰ ØªØ´Ø±Ø¨ Ù…ÙˆÙŠØ©. ÙˆØ´ ØªØ°Ø§ÙƒØ± Ø§Ù„Ø­ÙŠÙ†ØŸ` 
                    : `I know the pressure is high, but you got this. Start with something easy to gain momentum. Don't forget to hydrate. What are you studying?`;
            }
            if (topic === 'longing') {
                return isArabic 
                    ? `Ø§Ù„Ø´ÙˆÙ‚ Ø¯Ù„ÙŠÙ„ Ø¹Ù„Ù‰ ØµØ¯Ù‚ Ø§Ù„Ù…Ø´Ø§Ø¹Ø±ØŒ Ù„ÙƒÙ†Ù‡ Ù…Ø¤Ù„Ù… Ø£Ø­ÙŠØ§Ù†Ø§Ù‹. ØªØ°ÙƒØ± Ø§Ù„Ù„Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ù„ÙˆØ© ÙˆØ®Ù„Ù‡Ø§ Ù…ØµØ¯Ø± Ù‚ÙˆØ© Ù„ÙƒØŒ Ù…Ùˆ Ø­Ø²Ù†.` 
                    : `Longing shows you cared deeply, but it can hurt. Try to remember the good moments as strength, not just sadness.`;
            }

            // 8. General / Fallback - Pure Active Listening (No "What do you mean?")
            // If we don't know what to say, we encourage the user to continue naturally.
            const genericResponses = isArabic ? [
                `ÙƒÙ…Ù„ØŒ Ø£Ù†Ø§ Ù…Ø¹Ùƒ ÙˆØ£Ø³Ù…Ø¹Ùƒ Ø¨Ù‚Ù„Ø¨ÙŠ.`,
                `ÙƒÙ„Ø§Ù…Ùƒ ÙŠÙ„Ø§Ù…Ø³ Ø§Ù„Ù‚Ù„Ø¨...`,
                `ØµØ­ÙŠØ­.. ÙˆØ£Ø­ÙŠØ§Ù†Ø§Ù‹ Ø§Ù„ÙˆØ§Ø­Ø¯ ÙŠØ­ØªØ§Ø¬ Ø¨Ø³ ÙŠØªÙƒÙ„Ù… Ø¹Ø´Ø§Ù† ÙŠØ±ØªØ§Ø­.`,
                `ÙØ§Ù‡Ù… Ø¹Ù„ÙŠÙƒ.. ÙƒÙ…Ù„ ÙØ¶ÙØ¶Ø©.`,
                `ÙŠØ§ Ø§Ù„Ù„Ù‡.. ÙˆØ´ ØµØ§Ø± Ø¨Ø¹Ø¯ÙŠÙ†ØŸ`,
                `ÙØ¹Ù„Ø§Ù‹ØŒ Ù‡Ø°Ø§ Ø§Ù„Ø´ÙŠ ÙŠØ®Ù„ÙŠ Ø§Ù„ÙˆØ§Ø­Ø¯ ÙŠÙÙƒØ± ÙƒØ«ÙŠØ±.`,
                `Ø®Ø° Ø±Ø§Ø­ØªÙƒ Ø¨Ø§Ù„ÙƒÙ„Ø§Ù…ØŒ Ø§Ù„Ù…Ø¬Ø§Ù„ Ù…ÙØªÙˆØ­ Ù„Ùƒ.`
            ] : [
                `Go on, I'm listening with my heart.`,
                `That sounds important...`,
                `I understand. Sometimes we just need to talk to feel better.`,
                `I see... tell me more.`,
                `Wow... and what happened next?`,
                `That really makes you think.`,
                `Take your time, I'm here for you.`
            ];

            return getRandom(genericResponses);
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const msg = input.value.trim();
            if (!msg) return;

            const messages = document.getElementById('chatMessages');
            messages.innerHTML += `<div class="chat-bubble flex justify-end"><div class="bg-purple-600 rounded-2xl rounded-br-sm px-4 py-2 max-w-[80%]">${msg}</div></div>`;
            input.value = '';

            // Store message for admin
            let storedMsgs = JSON.parse(localStorage.getItem('chatMessages') || '[]');
            storedMsgs.push({ msg, time: new Date().toLocaleString('ar-SA') });
            localStorage.setItem('chatMessages', JSON.stringify(storedMsgs.slice(-50)));

            setTimeout(() => {
                const response = getAIResponse(msg);
                messages.innerHTML += `<div class="chat-bubble flex justify-start"><div class="bg-gray-700 rounded-2xl rounded-bl-sm px-4 py-2 max-w-[80%]">${response}</div></div>`;
                messages.scrollTop = messages.scrollHeight;
            }, 500 + Math.random() * 1000);
        }

        // Quotes System - 100 quotes
        const quotesAr = [
            { text: 'Ø§Ù„Ø³Ø¹Ø§Ø¯Ø© Ù„ÙŠØ³Øª ÙÙŠ Ù…Ø§ Ù†Ù…Ù„ÙƒÙ‡ØŒ Ø¨Ù„ ÙÙŠ Ù…Ø§ Ù†Ø´Ø¹Ø± Ø¨Ù‡', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'ÙƒÙ† Ù„Ø·ÙŠÙØ§Ù‹ØŒ ÙÙƒÙ„ Ø´Ø®Øµ ØªÙ‚Ø§Ø¨Ù„Ù‡ ÙŠØ®ÙˆØ¶ Ù…Ø¹Ø±ÙƒØ© ØµØ¹Ø¨Ø©', author: 'Ø£ÙÙ„Ø§Ø·ÙˆÙ†' },
            { text: 'Ø§Ù„Ø­ÙŠØ§Ø© Ù‚ØµÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ Ù„Ù†Ù‚Ø¶ÙŠÙ‡Ø§ ÙÙŠ Ø§Ù„Ù†Ø¯Ù…', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'Ø§Ù„Ù†Ø¬Ø§Ø­ Ù„ÙŠØ³ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ÙˆØ§Ù„ÙØ´Ù„ Ù„ÙŠØ³ Ù‚Ø§ØªÙ„Ø§Ù‹', author: 'ÙˆÙŠÙ†Ø³ØªÙˆÙ† ØªØ´Ø±Ø´Ù„' },
            { text: 'ÙƒÙ„ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯ Ù‡Ùˆ ÙØ±ØµØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªØºÙŠÙŠØ±', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'Ù„Ø§ ØªÙ‚Ø§Ø±Ù† Ù†ÙØ³Ùƒ Ø¨Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†ØŒ Ù‚Ø§Ø±Ù† Ù†ÙØ³Ùƒ Ø¨Ù†ÙØ³Ùƒ Ø¨Ø§Ù„Ø£Ù…Ø³', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'Ø§Ù„ØµØ¨Ø± Ù…ÙØªØ§Ø­ Ø§Ù„ÙØ±Ø¬', author: 'Ø­Ø¯ÙŠØ« Ø´Ø±ÙŠÙ' },
            { text: 'Ø§Ø¨ØªØ³Ù… ÙØ¥Ù† Ø§Ù„Ø§Ø¨ØªØ³Ø§Ù…Ø© ØµØ¯Ù‚Ø©', author: 'Ø­Ø¯ÙŠØ« Ø´Ø±ÙŠÙ' },
            { text: 'Ù…Ù† ØµØ¨Ø± Ø¸ÙØ±', author: 'Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ' },
            { text: 'Ø§Ù„Ø¹Ù‚Ù„ Ø§Ù„Ø³Ù„ÙŠÙ… ÙÙŠ Ø§Ù„Ø¬Ø³Ù… Ø§Ù„Ø³Ù„ÙŠÙ…', author: 'Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ' },
            { text: 'Ø§Ù„Ø£Ù…Ù„ Ù‡Ùˆ Ø­Ù„Ù… Ø§Ù„ÙŠÙ‚Ø¸Ø©', author: 'Ø£Ø±Ø³Ø·Ùˆ' },
            { text: 'ÙƒÙ† Ø£Ù†Øª Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø±Ø¤ÙŠØªÙ‡ ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…', author: 'ØºØ§Ù†Ø¯ÙŠ' },
            { text: 'Ø§Ù„Ø­Ø¨ Ù‡Ùˆ Ø§Ù„Ù‚ÙˆØ© Ø§Ù„ÙˆØ­ÙŠØ¯Ø© Ø§Ù„Ù‚Ø§Ø¯Ø±Ø© Ø¹Ù„Ù‰ ØªØ­ÙˆÙŠÙ„ Ø¹Ø¯Ùˆ Ø¥Ù„Ù‰ ØµØ¯ÙŠÙ‚', author: 'Ù…Ø§Ø±ØªÙ† Ù„ÙˆØ«Ø± ÙƒÙŠÙ†Ø¬' },
            { text: 'Ù„Ø§ ØªØ®Ù Ù…Ù† Ø§Ù„Ø³ÙŠØ± Ø¨Ø¨Ø·Ø¡ØŒ Ø®Ù ÙÙ‚Ø· Ù…Ù† Ø§Ù„ÙˆÙ‚ÙˆÙ', author: 'Ù…Ø«Ù„ ØµÙŠÙ†ÙŠ' },
            { text: 'Ø§Ù„Ù†Ø¬Ø§Ø­ Ù‡Ùˆ Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ù† ÙØ´Ù„ Ø¥Ù„Ù‰ ÙØ´Ù„ Ø¯ÙˆÙ† ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø­Ù…Ø§Ø³', author: 'ØªØ´Ø±Ø´Ù„' },
            { text: 'ÙƒÙ„ Ø´ÙŠØ¡ Ù…Ù…ÙƒÙ† Ù„Ù…Ù† ÙŠØ¤Ù…Ù†', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'Ø§Ù„Ø­ÙŠØ§Ø© Ù„ÙŠØ³Øª ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¹Ø§ØµÙØ©ØŒ Ø¨Ù„ ÙÙŠ ØªØ¹Ù„Ù… Ø§Ù„Ø±Ù‚Øµ ØªØ­Øª Ø§Ù„Ù…Ø·Ø±', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'Ø£Ù†Øª Ø£Ù‚ÙˆÙ‰ Ù…Ù…Ø§ ØªØ¹ØªÙ‚Ø¯', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'Ø§Ù„Ø³Ù„Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ ÙŠØ¨Ø¯Ø£ Ø¹Ù†Ø¯Ù…Ø§ ØªØ®ØªØ§Ø± Ø¹Ø¯Ù… Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø¢Ø®Ø±ÙŠÙ† Ø¨Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù…Ø´Ø§Ø¹Ø±Ùƒ', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'Ø§Ù„Ø±Ø§Ø­Ø© Ø§Ù„Ù†ÙØ³ÙŠØ© ØªØ£ØªÙŠ Ù…Ù† Ø§Ù„Ù‚Ù†Ø§Ø¹Ø©', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'ÙƒÙ„ Ù†Ù‡Ø§ÙŠØ© Ù‡ÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'Ø§Ù„ÙˆÙ‚Øª ÙŠØ¯Ø§ÙˆÙŠ ÙƒÙ„ Ø´ÙŠØ¡', author: 'Ù…Ø«Ù„ Ø´Ø¹Ø¨ÙŠ' },
            { text: 'Ø§Ø²Ø±Ø¹ Ø®ÙŠØ±Ø§Ù‹ ØªØ­ØµØ¯ Ø®ÙŠØ±Ø§Ù‹', author: 'Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ' },
            { text: 'Ø±Ø­Ù„Ø© Ø§Ù„Ø£Ù„Ù Ù…ÙŠÙ„ ØªØ¨Ø¯Ø£ Ø¨Ø®Ø·ÙˆØ©', author: 'Ù„Ø§Ùˆ ØªØ²Ùˆ' },
            { text: 'Ø§Ù„Ø¶Ø­Ùƒ Ù‡Ùˆ Ø£ÙØ¶Ù„ Ø¯ÙˆØ§Ø¡', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            // Adding more quotes to reach 100
            { text: 'Ù…Ù† Ø·Ù„Ø¨ Ø§Ù„Ø¹Ù„Ø§ Ø³Ù‡Ø± Ø§Ù„Ù„ÙŠØ§Ù„ÙŠ', author: 'Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ' },
            { text: 'ÙÙŠ Ø§Ù„ØªØ£Ù†ÙŠ Ø§Ù„Ø³Ù„Ø§Ù…Ø©', author: 'Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ' },
            { text: 'Ø§Ù„ØµØ¯ÙŠÙ‚ ÙˆÙ‚Øª Ø§Ù„Ø¶ÙŠÙ‚', author: 'Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ' },
            { text: 'Ø§Ù„Ù‚Ù†Ø§Ø¹Ø© ÙƒÙ†Ø² Ù„Ø§ ÙŠÙÙ†Ù‰', author: 'Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ' },
            { text: 'Ù…Ù† Ø¬Ø¯ ÙˆØ¬Ø¯', author: 'Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ' },
            { text: 'Ø§Ù„ØµØ­Ø© ØªØ§Ø¬ Ø¹Ù„Ù‰ Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£ØµØ­Ø§Ø¡', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'Ø§Ù„Ø¹Ù„Ù… Ù†ÙˆØ± ÙˆØ§Ù„Ø¬Ù‡Ù„ Ø¸Ù„Ø§Ù…', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'Ø§Ù„Ø£Ù…Ù„ ÙŠØ£ØªÙŠ Ù…Ø¹ ÙƒÙ„ Ø´Ø±ÙˆÙ‚', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø­ÙŠØ« Ø£Ù†Øª', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'Ù„Ø§ ØªØ³ØªØ³Ù„Ù… Ø£Ø¨Ø¯Ø§Ù‹', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'Ø£Ù†Øª ØªØ³ØªØ­Ù‚ Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'ØºØ¯Ø§Ù‹ ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'Ø§Ù„Ø­Ø¨ ÙŠØ´ÙÙŠ ÙƒÙ„ Ø´ÙŠØ¡', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'Ø«Ù‚ Ø¨Ù†ÙØ³Ùƒ', author: 'Ù…Ø¬Ù‡ÙˆÙ„' },
            { text: 'Ø£Ù†Øª Ù…Ù…ÙŠØ²', author: 'Ù…Ø¬Ù‡ÙˆÙ„' }
        ];

        const quotesEn = [
            { text: 'Happiness is not about what you have, but what you feel', author: 'Unknown' },
            { text: 'Be kind, for everyone is fighting a hard battle', author: 'Plato' },
            { text: 'Life is too short to live with regret', author: 'Unknown' },
            { text: 'Success is not final, failure is not fatal', author: 'Winston Churchill' },
            { text: 'Every new day is a new chance to change', author: 'Unknown' },
            { text: 'Don\'t compare yourself to others, compare yourself to who you were yesterday', author: 'Unknown' },
            { text: 'The best time to plant a tree was 20 years ago. The second best time is now', author: 'Chinese Proverb' },
            { text: 'Be yourself; everyone else is already taken', author: 'Oscar Wilde' },
            { text: 'In the middle of difficulty lies opportunity', author: 'Albert Einstein' },
            { text: 'The only way to do great work is to love what you do', author: 'Steve Jobs' },
            { text: 'Believe you can and you\'re halfway there', author: 'Theodore Roosevelt' },
            { text: 'It does not matter how slowly you go as long as you do not stop', author: 'Confucius' },
            { text: 'The future belongs to those who believe in their dreams', author: 'Eleanor Roosevelt' },
            { text: 'Peace comes from within. Do not seek it without', author: 'Buddha' },
            { text: 'Happiness is when what you think, say, and do are in harmony', author: 'Gandhi' },
            { text: 'The mind is everything. What you think you become', author: 'Buddha' },
            { text: 'You are never too old to set a new goal', author: 'C.S. Lewis' },
            { text: 'Start where you are. Use what you have. Do what you can', author: 'Arthur Ashe' },
            { text: 'The only impossible journey is the one you never begin', author: 'Tony Robbins' },
            { text: 'Everything you\'ve ever wanted is on the other side of fear', author: 'George Addair' }
        ];

        let currentQuoteIndex = 0;
        function getQuotes() { return currentLang === 'ar' ? quotesAr : quotesEn; }

        function nextQuote() {
            const quotes = getQuotes();
            const dayOfYear = Math.floor((Date.now() - new Date(new Date().getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            currentQuoteIndex = (dayOfYear + Math.floor(Math.random() * quotes.length)) % quotes.length;
            displayQuote();
        }

        function displayQuote() {
            const quotes = getQuotes();
            const quote = quotes[currentQuoteIndex % quotes.length];
            
            // Update panel quote
            const qText = document.getElementById('quoteText');
            const qAuth = document.getElementById('quoteAuthor');
            if(qText) qText.textContent = `"${quote.text}"`;
            if(qAuth) qAuth.textContent = `â€” ${quote.author}`;

            // Update home quote
            const homeText = document.getElementById('mainQuoteText');
            const homeAuth = document.getElementById('mainQuoteAuthor');
            if(homeText) homeText.textContent = `"${quote.text}"`;
            if(homeAuth) homeAuth.textContent = `â€” ${quote.author}`;
        }

        function cleanTextForSpeech(text) {
            // Remove emojis, specific symbols and numbers as requested
            return text.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g, '')
                       .replace(/[0-9Ù -Ù©]/g, '');
        }

        function speakQuote() {
            let text = document.getElementById('quoteText').textContent;
            text = cleanTextForSpeech(text);
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = currentLang === 'ar' ? 'ar-SA' : 'en-US';
            utterance.rate = 0.9;
            const voices = speechSynthesis.getVoices();
            const femaleVoice = voices.find(v => (v.name.includes('Female') || v.name.includes('Samantha') || v.name.includes('Google')) && v.lang.startsWith(currentLang === 'ar' ? 'ar' : 'en'));
            if (femaleVoice) utterance.voice = femaleVoice;
            speechSynthesis.speak(utterance);
        }

        // Games System
        const gamesData = [
            { id: 'memory', name: 'Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©', nameEn: 'Memory Game', icon: 'ğŸ§ ' },
            { id: 'guess', name: 'Ø®Ù…Ù† Ø§Ù„Ø±Ù‚Ù…', nameEn: 'Guess Number', icon: 'ğŸ”¢' },
            { id: 'sequence', name: 'ØªØ°ÙƒØ± Ø§Ù„ØªØ³Ù„Ø³Ù„', nameEn: 'Sequence Memory', icon: 'ğŸ” ' },
            { id: 'reaction', name: 'Ø³Ø±Ø¹Ø© Ø§Ù„Ø¶ØºØ·', nameEn: 'Reaction Test', icon: 'âš¡' },
            { id: 'pattern', name: 'Ù†Ù…Ø· Ø§Ù„Ø£Ø´ÙƒØ§Ù„', nameEn: 'Pattern Match', icon: 'ğŸ”º' },
            { id: 'math', name: 'ØªØ­Ø¯ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª', nameEn: 'Math Challenge', icon: 'â•' }
        ];

        function loadGames() {
            const container = document.getElementById('gamesContent');
            const dayIndex = new Date().getDate() % gamesData.length;
            container.innerHTML = gamesData.map((game, i) => `
                <div class="game-card bg-gradient-to-br from-gray-800 to-gray-700 rounded-2xl p-6 cursor-pointer transition-all hover:glow" onclick="playGame('${game.id}')">
                    <div class="text-5xl mb-4">${game.icon}</div>
                    <h4 class="text-xl font-bold">${currentLang === 'ar' ? game.name : game.nameEn}</h4>
                    ${i === dayIndex ? '<span class="bg-pink-600 text-xs px-2 py-1 rounded-full mt-2 inline-block">'+(currentLang === 'ar' ? 'Ù„Ø¹Ø¨Ø© Ø§Ù„ÙŠÙˆÙ…' : 'Today\'s Game')+'</span>' : ''}
                </div>
            `).join('');
        }

        function playGame(id) {
            const gameArea = document.getElementById('gamesContent');
            switch(id) {
                case 'memory':
                    startMemoryGame(gameArea);
                    break;
                case 'guess':
                    startGuessGame(gameArea);
                    break;
                case 'sequence':
                    startSequenceGame(gameArea);
                    break;
                case 'reaction':
                    startReactionGame(gameArea);
                    break;
                case 'pattern':
                    startPatternGame(gameArea);
                    break;
                case 'math':
                    startMathGame(gameArea);
                    break;
            }
        }

        function startMemoryGame(area) {
            const emojis = ['ğŸŒ¸', 'ğŸŒ™', 'â­', 'ğŸ’œ', 'ğŸ¦‹', 'ğŸŒˆ', 'â˜ï¸', 'ğŸŒº'];
            let cards = [...emojis, ...emojis].sort(() => Math.random() - 0.5);
            
            area.innerHTML = `
                <button onclick="loadGames()" class="mb-4 bg-gray-700 px-4 py-2 rounded-lg">â† ${currentLang === 'ar' ? 'Ø±Ø¬ÙˆØ¹' : 'Back'}</button>
                <div class="text-center mb-4">
                    <h3 class="text-2xl">${currentLang === 'ar' ? 'Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©' : 'Memory Game'}</h3>
                    <p class="text-gray-300">${currentLang === 'ar' ? 'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ù…ØªØ·Ø§Ø¨Ù‚Ø©' : 'Find matching pairs'}</p>
                </div>
                <div class="grid grid-cols-4 gap-2" id="memoryGrid">
                    ${cards.map((e, i) => `<div class="memory-card bg-purple-600 h-20 rounded-xl flex items-center justify-center text-3xl cursor-pointer" data-index="${i}" data-emoji="${e}" onclick="flipCard(this)">â“</div>`).join('')}
                </div>
                <div id="memoryResult" class="text-center mt-4 hidden"></div>
            `;
        }

        window.flipCard = function(el) {
            if (el.classList.contains('matched') || el.classList.contains('flipped')) return;
            el.textContent = el.dataset.emoji;
            el.classList.add('flipped', 'bg-gray-700');
            const flipped = document.querySelectorAll('.memory-card.flipped:not(.matched)');
            if (flipped.length === 2) {
                setTimeout(() => {
                    if (flipped[0].dataset.emoji === flipped[1].dataset.emoji) {
                        flipped.forEach(c => c.classList.add('matched'));
                        if (document.querySelectorAll('.matched').length === 16) {
                            // Show win message and restart automatically
                            const resultDiv = document.getElementById('memoryResult');
                            resultDiv.textContent = currentLang === 'ar' ? 'ğŸ‰ ÙØ²Øª! Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© ØªØ¨Ø¯Ø£...' : 'ğŸ‰ You won! New game starting...';
                            resultDiv.classList.remove('hidden');
                            setTimeout(() => {
                                startMemoryGame(document.getElementById('gamesContent'));
                            }, 1500);
                        }
                    } else {
                        flipped.forEach(c => { c.textContent = 'â“'; c.classList.remove('flipped', 'bg-gray-700'); });
                    }
                }, 500);
            }
        };

        function startGuessGame(area) {
            const secret = Math.floor(Math.random() * 100) + 1;
            area.innerHTML = `
                <button onclick="loadGames()" class="mb-4 bg-gray-700 px-4 py-2 rounded-lg">â† ${currentLang === 'ar' ? 'Ø±Ø¬ÙˆØ¹' : 'Back'}</button>
                <div class="bg-gray-800 rounded-2xl p-6 text-center">
                    <h3 class="text-2xl mb-4">${currentLang === 'ar' ? 'Ø®Ù…Ù† Ø§Ù„Ø±Ù‚Ù… Ù…Ù† 1 Ø¥Ù„Ù‰ 100' : 'Guess 1-100'}</h3>
                    <input type="number" id="guessInput" class="bg-gray-700 rounded-lg px-4 py-3 text-center text-2xl w-32 mb-4" min="1" max="100">
                    <div id="guessResult" class="text-xl mb-4"></div>
                    <button onclick="checkGuess(${secret})" class="bg-purple-600 px-6 py-3 rounded-lg">${currentLang === 'ar' ? 'ØªØ®Ù…ÙŠÙ†' : 'Guess'}</button>
                </div>
            `;
        }

        window.checkGuess = function(secret) {
            const guess = parseInt(document.getElementById('guessInput').value);
            const result = document.getElementById('guessResult');
            if (guess === secret) {
                result.innerHTML = currentLang === 'ar' ? 'ğŸ‰ ØµØ­ÙŠØ­! Ù…Ø¨Ø±ÙˆÙƒ! (Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© ØªØ¨Ø¯Ø£...)' : 'ğŸ‰ Correct! (New game starting...)';
                setTimeout(() => {
                    startGuessGame(document.getElementById('gamesContent'));
                }, 1500);
            } else if (guess < secret) {
                result.innerHTML = currentLang === 'ar' ? 'â¬†ï¸ Ø£Ø¹Ù„Ù‰!' : 'â¬†ï¸ Higher!';
            } else {
                result.innerHTML = currentLang === 'ar' ? 'â¬‡ï¸ Ø£Ù‚Ù„!' : 'â¬‡ï¸ Lower!';
            }
        };

        function startRPSGame(area) {
            area.innerHTML = `
                <button onclick="loadGames()" class="mb-4 bg-gray-700 px-4 py-2 rounded-lg">â† ${currentLang === 'ar' ? 'Ø±Ø¬ÙˆØ¹' : 'Back'}</button>
                <div class="bg-gray-800 rounded-2xl p-6 text-center">
                    <h3 class="text-2xl mb-6">${currentLang === 'ar' ? 'Ø§Ø®ØªØ±!' : 'Choose!'}</h3>
                    <div class="flex justify-center gap-4 mb-6">
                        <button onclick="playRPS('rock')" class="text-5xl hover:scale-125 transition-transform">âœŠ</button>
                        <button onclick="playRPS('paper')" class="text-5xl hover:scale-125 transition-transform">âœ‹</button>
                        <button onclick="playRPS('scissors')" class="text-5xl hover:scale-125 transition-transform">âœŒï¸</button>
                    </div>
                    <div id="rpsResult" class="text-2xl mb-4"></div>
                    <button id="rpsRestart" class="hidden bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg">${currentLang === 'ar' ? 'Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰' : 'Play Again'}</button>
                </div>
            `;
            
            document.getElementById('rpsRestart').onclick = () => startRPSGame(area);
        }

        window.playRPS = function(choice) {
            const options = ['rock', 'paper', 'scissors'];
            const emojis = { rock: 'âœŠ', paper: 'âœ‹', scissors: 'âœŒï¸' };
            const cpu = options[Math.floor(Math.random() * 3)];
            let result;
            if (choice === cpu) result = currentLang === 'ar' ? 'ØªØ¹Ø§Ø¯Ù„! ğŸ¤' : 'Tie! ğŸ¤';
            else if ((choice === 'rock' && cpu === 'scissors') || (choice === 'paper' && cpu === 'rock') || (choice === 'scissors' && cpu === 'paper'))
                result = currentLang === 'ar' ? 'ÙØ²Øª! ğŸ‰' : 'You win! ğŸ‰';
            else result = currentLang === 'ar' ? 'Ø®Ø³Ø±Øª! ğŸ˜…' : 'You lose! ğŸ˜…';
            document.getElementById('rpsResult').innerHTML = `${emojis[choice]} vs ${emojis[cpu]}<br>${result}`;
            document.getElementById('rpsRestart').classList.remove('hidden');
        };

        function startSequenceGame(area) {
            const symbols = ['ğŸ”´', 'ğŸ”µ', 'ğŸŸ¢', 'ğŸŸ¡', 'ğŸŸ ', 'ğŸŸ£'];
            let sequence = [];
            let playerTurn = false;
            let currentIndex = 0;
            
            function generateSequence() {
                sequence.push(symbols[Math.floor(Math.random() * symbols.length)]);
            }
            
            function playSequence() {
                playerTurn = false;
                let i = 0;
                const interval = setInterval(() => {
                    area.querySelector('#seqDisplay').textContent = sequence[i];
                    i++;
                    if (i >= sequence.length) {
                        clearInterval(interval);
                        setTimeout(() => {
                            area.querySelector('#seqDisplay').textContent = 'â“';
                            playerTurn = true;
                            area.querySelector('#seqMessage').textContent = currentLang === 'ar' ? 'ÙƒØ±Ø± Ø§Ù„ØªØ³Ù„Ø³Ù„!' : 'Repeat the sequence!';
                        }, 500);
                    }
                }, 800);
            }
            
            area.innerHTML = `
                <button onclick="loadGames()" class="mb-4 bg-gray-700 px-4 py-2 rounded-lg">â† ${currentLang === 'ar' ? 'Ø±Ø¬ÙˆØ¹' : 'Back'}</button>
                <div class="bg-gray-800 rounded-2xl p-6 text-center">
                    <h3 class="text-2xl mb-4">${currentLang === 'ar' ? 'ØªØ°ÙƒØ± Ø§Ù„ØªØ³Ù„Ø³Ù„!' : 'Remember the Sequence!'}</h3>
                    <div id="seqDisplay" class="text-6xl my-8">â“</div>
                    <div id="seqMessage" class="text-xl mb-4">${currentLang === 'ar' ? 'Ø´Ø§Ù‡Ø¯ Ø«Ù… ÙƒØ±Ø±' : 'Watch then repeat'}</div>
                    <div class="grid grid-cols-3 gap-2 max-w-xs mx-auto">
                        ${symbols.map((s, i) => `<button onclick="seqButtonClick('${s}')" class="text-3xl p-4 rounded-xl bg-gray-700 hover:bg-gray-600">${s}</button>`).join('')}
                    </div>
                    <div id="seqScore" class="text-2xl mt-4">${currentLang === 'ar' ? 'Ø§Ù„Ø·ÙˆÙ„: ' : 'Length: '}0</div>
                    <div id="seqResult" class="text-xl mt-4 hidden"></div>
                </div>
            `;
            
            generateSequence();
            playSequence();
            
            window.seqButtonClick = function(symbol) {
                if (!playerTurn) return;
                
                const expected = sequence[currentIndex];
                if (symbol === expected) {
                    currentIndex++;
                    if (currentIndex >= sequence.length) {
                        // Level complete
                        area.querySelector('#seqResult').textContent = currentLang === 'ar' ? 'ğŸ‰ Ù…Ù…ØªØ§Ø²! Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯!' : 'ğŸ‰ Excellent! New level!';
                        area.querySelector('#seqResult').classList.remove('hidden');
                        setTimeout(() => {
                            currentIndex = 0;
                            generateSequence();
                            area.querySelector('#seqScore').textContent = (currentLang === 'ar' ? 'Ø§Ù„Ø·ÙˆÙ„: ' : 'Length: ') + sequence.length;
                            area.querySelector('#seqResult').classList.add('hidden');
                            playSequence();
                        }, 1500);
                    }
                } else {
                    // Game over
                    area.querySelector('#seqResult').textContent = currentLang === 'ar' ? `âŒ Ø®Ø³Ø±Øª! Ø§Ù„Ø·ÙˆÙ„: ${sequence.length}` : `âŒ Game over! Length: ${sequence.length}`;
                    area.querySelector('#seqResult').classList.remove('hidden');
                    setTimeout(() => {
                        startSequenceGame(area);
                    }, 2000);
                }
            };
        }

        function startReactionGame(area) {
            let startTime, timeoutId, gameActive = false;
            
            function startRound() {
                gameActive = false;
                area.querySelector('#reactBtn').textContent = 'â³';
                area.querySelector('#reactBtn').className = 'bg-gray-600 w-32 h-32 rounded-full text-4xl';
                area.querySelector('#reactMessage').textContent = currentLang === 'ar' ? 'Ø§Ù†ØªØ¸Ø±... Ø«Ù… Ø§Ø¶ØºØ·!' : 'Wait... then click!';
                
                const delay = 1000 + Math.random() * 3000;
                timeoutId = setTimeout(() => {
                    area.querySelector('#reactBtn').textContent = 'âš¡';
                    area.querySelector('#reactBtn').className = 'bg-green-600 w-32 h-32 rounded-full text-4xl hover:scale-110 transition-transform';
                    startTime = Date.now();
                    gameActive = true;
                    area.querySelector('#reactMessage').textContent = currentLang === 'ar' ? 'Ø§Ø¶ØºØ· Ø§Ù„Ø¢Ù†!' : 'Click now!';
                }, delay);
            }
            
            area.innerHTML = `
                <button onclick="loadGames()" class="mb-4 bg-gray-700 px-4 py-2 rounded-lg">â† ${currentLang === 'ar' ? 'Ø±Ø¬ÙˆØ¹' : 'Back'}</button>
                <div class="bg-gray-800 rounded-2xl p-6 text-center">
                    <h3 class="text-2xl mb-4">${currentLang === 'ar' ? 'Ø³Ø±Ø¹Ø© Ø±Ø¯ Ø§Ù„ÙØ¹Ù„!' : 'Reaction Speed!'}</h3>
                    <div id="reactMessage" class="text-xl mb-4">${currentLang === 'ar' ? 'Ø§Ø¶ØºØ· Ø¹Ù†Ø¯Ù…Ø§ ÙŠØªØºÙŠØ± Ø§Ù„Ù„ÙˆÙ†' : 'Click when color changes'}</div>
                    <button id="reactBtn" onclick="reactClick()" class="bg-gray-600 w-32 h-32 rounded-full text-4xl">â³</button>
                    <div id="reactTime" class="text-2xl mt-4">${currentLang === 'ar' ? 'Ø§Ù„ÙˆÙ‚Øª: ' : 'Time: '}0ms</div>
                    <div id="reactBest" class="text-xl mt-2">${currentLang === 'ar' ? 'Ø£ÙØ¶Ù„ ÙˆÙ‚Øª: ' : 'Best: '}-</div>
                    <div id="reactResult" class="text-xl mt-4 hidden"></div>
                </div>
            `;
            
            let bestTime = null;
            startRound();
            
            window.reactClick = function() {
                if (!gameActive) {
                    // Clicked too early
                    clearTimeout(timeoutId);
                    area.querySelector('#reactResult').textContent = currentLang === 'ar' ? 'â° Ù…Ø¨ÙƒØ± Ø¬Ø¯Ø§Ù‹! Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰' : 'â° Too early! Try again';
                    area.querySelector('#reactResult').classList.remove('hidden');
                    setTimeout(() => {
                        area.querySelector('#reactResult').classList.add('hidden');
                        startRound();
                    }, 1500);
                    return;
                }
                
                const reactionTime = Date.now() - startTime;
                area.querySelector('#reactTime').textContent = (currentLang === 'ar' ? 'Ø§Ù„ÙˆÙ‚Øª: ' : 'Time: ') + reactionTime + 'ms';
                
                if (bestTime === null || reactionTime < bestTime) {
                    bestTime = reactionTime;
                    area.querySelector('#reactBest').textContent = (currentLang === 'ar' ? 'Ø£ÙØ¶Ù„ ÙˆÙ‚Øª: ' : 'Best: ') + bestTime + 'ms';
                }
                
                area.querySelector('#reactResult').textContent = (currentLang === 'ar' ? 'ğŸ‰ Ø¬ÙŠØ¯! Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©' : 'ğŸ‰ Good! New round');
                area.querySelector('#reactResult').classList.remove('hidden');
                
                setTimeout(() => {
                    area.querySelector('#reactResult').classList.add('hidden');
                    startRound();
                }, 1500);
            };
        }

        function startPatternGame(area) {
            const shapes = ['ğŸ”º', 'ğŸ”µ', 'ğŸŸ©', 'ğŸŸ¨', 'â¬œ', 'ğŸŸ§'];
            let pattern = [];
            let level = 1;
            
            function generatePattern() {
                pattern = [];
                for (let i = 0; i < level; i++) {
                    pattern.push(shapes[Math.floor(Math.random() * shapes.length)]);
                }
            }
            
            function displayPattern() {
                area.querySelector('#patDisplay').innerHTML = pattern.map(s => `<span class="text-4xl mx-1">${s}</span>`).join('');
                area.querySelector('#patMessage').textContent = currentLang === 'ar' ? 'ØªØ°ÙƒØ± Ø§Ù„Ù†Ù…Ø·!' : 'Remember the pattern!';
                
                setTimeout(() => {
                    area.querySelector('#patDisplay').innerHTML = 'â“ â“ â“';
                    area.querySelector('#patMessage').textContent = currentLang === 'ar' ? 'Ø§Ø®ØªØ± Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„ØµØ­ÙŠØ­' : 'Choose correct shape';
                    area.querySelectorAll('.shape-btn').forEach(btn => {
                        btn.disabled = false;
                        btn.classList.remove('opacity-50');
                    });
                }, 1500);
            }
            
            area.innerHTML = `
                <button onclick="loadGames()" class="mb-4 bg-gray-700 px-4 py-2 rounded-lg">â† ${currentLang === 'ar' ? 'Ø±Ø¬ÙˆØ¹' : 'Back'}</button>
                <div class="bg-gray-800 rounded-2xl p-6 text-center">
                    <h3 class="text-2xl mb-4">${currentLang === 'ar' ? 'Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ù†Ù…Ø·!' : 'Pattern Match!'}</h3>
                    <div id="patDisplay" class="text-4xl my-6">â“ â“ â“</div>
                    <div id="patMessage" class="text-xl mb-4">${currentLang === 'ar' ? 'Ø´Ø§Ù‡Ø¯ Ø«Ù… Ø§Ø®ØªØ±' : 'Watch then choose'}</div>
                    <div class="grid grid-cols-3 gap-2 max-w-xs mx-auto">
                        ${shapes.map(s => `<button onclick="patButtonClick('${s}')" class="shape-btn text-3xl p-4 rounded-xl bg-gray-700 hover:bg-gray-600 opacity-50" disabled>${s}</button>`).join('')}
                    </div>
                    <div id="patLevel" class="text-2xl mt-4">${currentLang === 'ar' ? 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ' : 'Level: '}1</div>
                    <div id="patResult" class="text-xl mt-4 hidden"></div>
                </div>
            `;
            
            let currentChoice = 0;
            generatePattern();
            displayPattern();
            
            window.patButtonClick = function(shape) {
                if (shape === pattern[currentChoice]) {
                    currentChoice++;
                    if (currentChoice >= pattern.length) {
                        // Level complete
                        level++;
                        area.querySelector('#patResult').textContent = currentLang === 'ar' ? `ğŸ‰ Ù…Ø³ØªÙˆÙ‰ ${level}!` : `ğŸ‰ Level ${level}!`;
                        area.querySelector('#patResult').classList.remove('hidden');
                        area.querySelector('#patLevel').textContent = (currentLang === 'ar' ? 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ' : 'Level: ') + level;
                        
                        setTimeout(() => {
                            currentChoice = 0;
                            generatePattern();
                            area.querySelector('#patResult').classList.add('hidden');
                            displayPattern();
                        }, 1500);
                    }
                } else {
                    // Game over
                    area.querySelector('#patResult').textContent = currentLang === 'ar' ? `âŒ Ø®Ø³Ø±Øª! ÙˆØµÙ„Øª Ù„Ù„Ù…Ø³ØªÙˆÙ‰ ${level}` : `âŒ Game over! Reached level ${level}`;
                    area.querySelector('#patResult').classList.remove('hidden');
                    setTimeout(() => {
                        level = 1;
                        currentChoice = 0;
                        generatePattern();
                        area.querySelector('#patLevel').textContent = (currentLang === 'ar' ? 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ' : 'Level: ') + level;
                        area.querySelector('#patResult').classList.add('hidden');
                        displayPattern();
                    }, 2000);
                }
            };
        }

        function startMathGame(area) {
            const a = Math.floor(Math.random() * 20) + 1;
            const b = Math.floor(Math.random() * 20) + 1;
            const ops = ['+', '-', 'Ã—'];
            const op = ops[Math.floor(Math.random() * ops.length)];
            let answer;
            switch(op) {
                case '+': answer = a + b; break;
                case '-': answer = a - b; break;
                case 'Ã—': answer = a * b; break;
            }
            
            area.innerHTML = `
                <button onclick="loadGames()" class="mb-4 bg-gray-700 px-4 py-2 rounded-lg">â† ${currentLang === 'ar' ? 'Ø±Ø¬ÙˆØ¹' : 'Back'}</button>
                <div class="bg-gray-800 rounded-2xl p-6 text-center">
                    <h3 class="text-4xl mb-6">${a} ${op} ${b} = ?</h3>
                    <input type="number" id="mathInput" class="bg-gray-700 rounded-lg px-4 py-3 text-center text-2xl w-32 mb-4">
                    <div id="mathResult" class="text-xl mb-4"></div>
                    <button onclick="checkMath(${answer})" class="bg-purple-600 px-6 py-3 rounded-lg">${currentLang === 'ar' ? 'ØªØ­Ù‚Ù‚' : 'Check'}</button>
                </div>
            `;
        }

        window.checkMath = function(answer) {
            const input = parseInt(document.getElementById('mathInput').value);
            const result = document.getElementById('mathResult');
            if (input === answer) {
                result.textContent = currentLang === 'ar' ? 'ğŸ‰ ØµØ­ÙŠØ­! (Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©...)' : 'ğŸ‰ Correct! (New round...)';
                setTimeout(() => startMathGame(document.getElementById('gamesContent')), 1200);
            } else {
                result.textContent = currentLang === 'ar' ? 'âŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰' : 'âŒ Try again';
            }
        };

        // Relaxation Exercises
        function loadRelaxation() {
            const exercisesAr = [
                { id: 'breath', name: 'ØªÙ†ÙØ³ Ø¹Ù…ÙŠÙ‚ Ù…Ù†Ø¸Ù…', desc: 'ØªÙ…Ø±ÙŠÙ† Ù…ÙƒÙˆÙ‘Ù† Ù…Ù† 6 Ø¬ÙˆÙ„Ø§Øª: Ø§Ø³ØªÙ†Ø´Ù‚ 4 Ø«ÙˆØ§Ù†ÙŠØŒ Ø§Ø­Ø¨Ø³ 4 Ø«ÙˆØ§Ù†ÙŠØŒ Ø§Ø²ÙØ± 4 Ø«ÙˆØ§Ù†ÙŠ.', icon: 'ğŸŒ¬ï¸', minutes: '2 - 3 Ø¯Ù‚Ø§Ø¦Ù‚' },
                { id: 'body', name: 'Ù…Ø³Ø­ Ø¬Ø³Ø¯ÙŠ Ù„Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡', desc: 'Ø§Ù†ØªÙ‚Ø§Ù„ Ù‡Ø§Ø¯Ø¦ Ù…Ù† Ø§Ù„Ø±Ø£Ø³ Ø­ØªÙ‰ Ø£ØµØ§Ø¨Ø¹ Ø§Ù„Ù‚Ø¯Ù… Ù…Ø¹ ØªÙˆØ¬ÙŠÙ‡Ø§Øª ØµÙˆØªÙŠØ© Ø¨Ø³ÙŠØ·Ø© ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø©.', icon: 'ğŸ§˜', minutes: '3 - 5 Ø¯Ù‚Ø§Ø¦Ù‚' },
                { id: 'muscle', name: 'Ø§Ø³ØªØ±Ø®Ø§Ø¡ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠ', desc: 'Ø´Ø¯Ù‘ ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¹Ø¶Ù„ÙŠØ© Ø«Ù… Ø¥Ø±Ø®Ø§Ø¤Ù‡Ø§ Ø¨ÙˆØ¹ÙŠ Ù„ØªÙ‡Ø¯Ø¦Ø© Ø§Ù„ØªÙˆØªØ±.', icon: 'ğŸ’ª', minutes: '3 Ø¯Ù‚Ø§Ø¦Ù‚' }
            ];
            const exercisesEn = [
                { id: 'breath', name: 'Guided Deep Breathing', desc: '6 cycles: inhale 4 sec, hold 4 sec, exhale 4 sec with soft guidance.', icon: 'ğŸŒ¬ï¸', minutes: '2 - 3 min' },
                { id: 'body', name: 'Body Scan Relaxation', desc: 'Slowly move your attention from head to toes with on-screen guidance.', icon: 'ğŸ§˜', minutes: '3 - 5 min' },
                { id: 'muscle', name: 'Progressive Muscle Relaxation', desc: 'Tense and release each muscle group gently to reduce tension.', icon: 'ğŸ’ª', minutes: '3 min' }
            ];

            const exercises = currentLang === 'ar' ? exercisesAr : exercisesEn;
            const container = document.getElementById('relaxContent');
            container.innerHTML = exercises.map(e => `
                <div class="bg-gradient-to-br from-green-800/50 to-emerald-900/50 rounded-2xl p-6">
                    <div class="flex items-start gap-4">
                        <span class="text-4xl mt-1">${e.icon}</span>
                        <div class="flex-1">
                            <h4 class="text-xl font-bold mb-1">${e.name}</h4>
                            <p class="text-green-200 text-sm mb-1">${e.desc}</p>
                            <p class="text-green-300 text-xs opacity-80">${currentLang === 'ar' ? 'Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©: ' : 'Estimated time: '}${e.minutes}</p>
                        </div>
                    </div>
                    <button onclick="startBreathing('${e.id}')" class="mt-4 bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg w-full text-sm font-medium">
                        ${currentLang === 'ar' ? 'Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø§Ù„Ø¢Ù†' : 'Start this exercise'}
                    </button>
                </div>
            `).join('');
        }

        // ØªÙ…Ø±ÙŠÙ† ØªÙØ§Ø¹Ù„ÙŠ Ø¹Ø§Ù…ØŒ ÙŠØªØºÙŠÙ‘Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ØªÙ…Ø±ÙŠÙ†
        window.startBreathing = function(type) {
            let phase = 0;
            let cycle = 1;
            const totalCycles = 6;

            const phasesAr = {
                breath: ['Ø§Ø³ØªÙ†Ø´Ù‚ Ø¨Ø¨Ø·Ø¡ 4 Ø«ÙˆØ§Ù†Ù ğŸŒ¬ï¸', 'Ø§Ø­Ø¨Ø³ Ø§Ù„Ù†ÙØ³ 4 Ø«ÙˆØ§Ù†Ù â¸ï¸', 'Ø§Ø²ÙØ± Ø¨Ù‡Ø¯ÙˆØ¡ 4 Ø«ÙˆØ§Ù†Ù ğŸ’¨'],
                body: ['Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø£Ø³ ÙˆØ§Ù„ÙˆØ¬Ù‡ âœ¨', 'Ø§Ù†Ø²Ù„ Ù„Ù„ÙƒØªÙÙŠÙ† ÙˆØ§Ù„ØµØ¯Ø± ğŸ«', 'Ø§Ø³ØªØ±Ø®Ù Ø§Ù„Ø¨Ø·Ù† ÙˆØ§Ù„Ù‚Ø¯Ù…ÙŠÙ† ğŸ‘£'],
                muscle: ['Ø´Ø¯Ù‘ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª Ø¨Ø±ÙÙ‚ ğŸ’ª', 'Ø«Ø¨Ù‘Øª Ø§Ù„ØªÙˆØªØ± Ù„Ù„Ø­Ø¸Ø© â¸ï¸', 'Ø§Ø±Ø®Ù Ø§Ù„Ø¹Ø¶Ù„Ø§Øª Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ğŸŒ¿']
            };

            const phasesEn = {
                breath: ['Slow inhale 4 sec ğŸŒ¬ï¸', 'Hold gently 4 sec â¸ï¸', 'Soft exhale 4 sec ğŸ’¨'],
                body: ['Focus on head & face âœ¨', 'Move to shoulders & chest ğŸ«', 'Relax belly & feet ğŸ‘£'],
                muscle: ['Gently tense muscles ğŸ’ª', 'Hold the tension briefly â¸ï¸', 'Fully release and relax ğŸŒ¿']
            };

            const phases = currentLang === 'ar' ? phasesAr[type] : phasesEn[type];
            const titleText = currentLang === 'ar'
                ? (type === 'breath' ? 'ØªÙ†ÙØ³ Ø¹Ù…ÙŠÙ‚ Ù…Ù†Ø¸Ù…' : type === 'body' ? 'ØªÙ…Ø±ÙŠÙ† Ù…Ø³Ø­ Ø¬Ø³Ø¯ÙŠ' : 'Ø§Ø³ØªØ±Ø®Ø§Ø¡ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠ')
                : (type === 'breath' ? 'Guided Deep Breathing' : type === 'body' ? 'Body Scan Exercise' : 'Progressive Muscle Relaxation');

            const doneLabel = currentLang === 'ar' ? 'Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªÙ…Ø±ÙŠÙ†ØŒ Ø®Ø° Ù„Ø­Ø¸Ø© Ù„Ù„Ø§Ø³ØªÙ…ØªØ§Ø¹ Ø¨Ø§Ù„Ù‡Ø¯ÙˆØ¡ ğŸ¤' : 'Exercise finished, enjoy this calm moment ğŸ¤';
            const cycleLabel = currentLang === 'ar' ? 'Ø¬ÙˆÙ„Ø©' : 'Cycle';

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="text-center max-w-sm w-full bg-gray-900/80 rounded-2xl p-6 border border-green-500/40">
                    <h3 class="text-xl font-bold mb-2">${titleText}</h3>
                    <p class="text-green-200 text-sm mb-4">${currentLang === 'ar' ? 'Ø§ØªØ¨Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© ÙˆØ®Ø° Ø±Ø§Ø­ØªÙƒ.' : 'Follow the on-screen guidance and take your time.'}</p>
                    <div id="breathText" class="text-2xl mb-4">${phases[0]}</div>
                    <div class="flex items-center justify-center mb-3">
                        <div id="breathCircle" class="w-32 h-32 rounded-full bg-green-500/20 border border-green-400/60 mx-auto transition-all duration-1000"></div>
                    </div>
                    <div class="flex justify-between text-xs text-green-300 mb-1">
                        <span id="cycleInfo">${cycleLabel} ${cycle} / ${totalCycles}</span>
                        <span id="phaseInfo">1 / 3</span>
                    </div>
                    <div id="timerInfo" class="text-xs text-green-400 mb-3 opacity-80"></div>
                    <button onclick="(function(m){ m.remove(); clearInterval(m._interval); })(this.closest('.fixed'))" class="mt-2 bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg text-sm">
                        ${currentLang === 'ar' ? 'Ø¥Ù†Ù‡Ø§Ø¡' : 'Finish'}
                    </button>
                </div>
            `;
            document.body.appendChild(modal);

            const circle = modal.querySelector('#breathCircle');
            const text = modal.querySelector('#breathText');
            const cycleInfo = modal.querySelector('#cycleInfo');
            const phaseInfo = modal.querySelector('#phaseInfo');
            const timerInfo = modal.querySelector('#timerInfo');

            const updateUI = () => {
                text.textContent = phases[phase];
                phaseInfo.textContent = `${phase + 1} / 3`;
                cycleInfo.textContent = `${cycleLabel} ${cycle} / ${totalCycles}`;

                if (type === 'breath') {
                    circle.style.transform = phase === 0 ? 'scale(1.3)' : phase === 1 ? 'scale(1.35)' : 'scale(1)';
                } else if (type === 'body') {
                    circle.style.transform = phase === 0 ? 'translateY(-8px)' : phase === 1 ? 'translateY(0)' : 'translateY(8px)';
                } else {
                    circle.style.transform = phase === 0 ? 'scale(1.1)' : phase === 1 ? 'scale(1.2)' : 'scale(0.95)';
                }
            };

            let secondsLeft = 4;
            timerInfo.textContent = currentLang === 'ar' ? `Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${secondsLeft}` : `Seconds left: ${secondsLeft}`;

            const interval = setInterval(() => {
                secondsLeft--;
                if (secondsLeft >= 0) {
                    timerInfo.textContent = currentLang === 'ar' ? `Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${secondsLeft}` : `Seconds left: ${secondsLeft}`;
                }
                if (secondsLeft <= 0) {
                    phase = (phase + 1) % 3;
                    if (phase === 0) {
                        cycle++;
                        if (cycle > totalCycles) {
                            clearInterval(interval);
                            text.textContent = doneLabel;
                            circle.style.transform = 'scale(1)';
                            timerInfo.textContent = '';
                            modal._interval = null;
                            return;
                        }
                    }
                    secondsLeft = 4;
                    updateUI();
                }
            }, 1000);

            modal._interval = interval;
            updateUI();
        };

        // Sleep Stories - 100 stories (longer and more exciting)
        const storiesAr = [
            { 
                title: 'Ù„ÙŠÙ„Ø© ÙÙŠ Ø§Ù„ØºØ§Ø¨Ø© Ø§Ù„Ø³Ø§Ø­Ø±Ø©', 
                content: 'ÙÙŠ Ø£Ø¹Ù…Ø§Ù‚ Ø§Ù„ØºØ§Ø¨Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©ØŒ Ø­ÙŠØ« Ø§Ù„Ø£Ø´Ø¬Ø§Ø± Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚Ø© ØªÙ„Ø§Ù…Ø³ Ø§Ù„Ø³Ù…Ø§Ø¡ Ø¨Ø£ØºØµØ§Ù†Ù‡Ø§ Ø§Ù„Ù…ØªØ´Ø§Ø¨ÙƒØ©ØŒ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø³Ø±ÙŒÙ‘ Ø¹Ø¸ÙŠÙ… ÙŠÙ†ØªØ¸Ø± Ù…Ù† ÙŠÙƒØªØ´ÙÙ‡. ØªØ­Øª Ø¶ÙˆØ¡ Ø§Ù„Ù‚Ù…Ø± Ø§Ù„ÙØ¶ÙŠ Ø§Ù„Ø°ÙŠ ÙŠØ®ØªØ±Ù‚ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„ÙƒØ«ÙŠÙØ©ØŒ ÙƒØ§Ù†Øª Ù…Ø®Ù„ÙˆÙ‚Ø§Øª Ø§Ù„Ù„ÙŠÙ„ ØªØ¨Ø¯Ø£ Ø±Ø­Ù„ØªÙ‡Ø§ Ø§Ù„Ø³Ø­Ø±ÙŠØ©. ÙØ±Ø§Ø´Ø§Øª Ù…ØªØ£Ù„Ù‚Ø© Ø¨Ø£Ù„ÙˆØ§Ù† Ù‚ÙˆØ³ Ù‚Ø²Ø­ ØªØªØ±Ø§Ù‚Øµ ÙÙŠ Ø§Ù„Ù‡ÙˆØ§Ø¡ØŒ ÙˆØ­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„ØºØ§Ø¨Ø© ØªØªØ¬Ù…Ø¹ Ø­ÙˆÙ„ Ø¨Ø­ÙŠØ±Ø© ØµØ§ÙÙŠØ© ØªØ¹ÙƒØ³ Ø§Ù„Ù†Ø¬ÙˆÙ… ÙƒÙ…Ø±Ø¢Ø© Ø³Ø­Ø±ÙŠØ©. ÙØ¬Ø£Ø©ØŒ Ø¸Ù‡Ø± Ù…Ø³Ø§Ø± Ù…Ù† Ø§Ù„Ø¶ÙˆØ¡ ÙŠØªÙ„Ø£Ù„Ø£ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶ØŒ ÙŠÙ‚ÙˆØ¯ Ø¥Ù„Ù‰ Ø´Ø¬Ø±Ø© Ø¹ØªÙŠÙ‚Ø© ÙÙŠ Ù‚Ù„Ø¨ Ø§Ù„ØºØ§Ø¨Ø©ØŒ Ø­ÙŠØ« ØªÙ‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø·ÙˆØ±Ø© Ø£Ù† Ø£Ù…Ù†ÙŠØ§Øª Ø§Ù„Ù‚Ù„Ø¨ ØªØªØ­Ù‚Ù‚ Ù„Ù…Ù† ÙŠØ¬Ø¯Ù‡Ø§ ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„. ÙƒØ§Ù†Øª Ø§Ù„Ø±ÙŠØ­ ØªÙ‡Ù…Ø³ Ø¨Ø£ØºÙ†ÙŠØ© Ù‚Ø¯ÙŠÙ…Ø©ØŒ ÙˆØ§Ù„Ø£Ø¶ÙˆØ§Ø¡ Ø§Ù„Ø®Ø§ÙØªØ© ØªØ±Ø³Ù… Ù„ÙˆØ­Ø§Øª Ø³Ø­Ø±ÙŠØ© Ø¹Ù„Ù‰ Ø¬Ø°ÙˆØ¹ Ø§Ù„Ø£Ø´Ø¬Ø§Ø±ØŒ ÙˆÙƒØ£Ù† Ø§Ù„ØºØ§Ø¨Ø© ÙƒÙ„Ù‡Ø§ ØªØ³ØªØ¹Ø¯ Ù„Ø­Ø¯Ø« Ø¹Ø¸ÙŠÙ… Ø³ÙŠØºÙŠØ± Ù…ØµÙŠØ± ÙƒÙ„ Ù…Ù† ÙÙŠÙ‡...' 
            },
            { 
                title: 'Ø±Ø­Ù„Ø© Ø¥Ù„Ù‰ Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø£Ø­Ù„Ø§Ù…', 
                content: 'Ø¹Ù„Ù‰ Ø­Ø§ÙØ© Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø­ÙŠØ« ØªÙ„ØªÙ‚ÙŠ Ø§Ù„Ø®ÙŠØ§Ù„ Ø¨Ø§Ù„ÙˆØ§Ù‚Ø¹ØŒ ØªÙ‚Ø¹ Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø£Ø­Ù„Ø§Ù… Ø§Ù„Ø¹Ø¸ÙŠÙ…Ø©. ÙƒÙ„ Ù„ÙŠÙ„Ø©ØŒ Ø¹Ù†Ø¯Ù…Ø§ ÙŠØºÙ…Ø¶ Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø£Ø¹ÙŠÙ†Ù‡Ù…ØŒ ØªÙØªØ­ Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„ÙØ¶ÙŠØ© Ù„ØªØ±Ø­Ø¨ Ø¨Ø§Ù„Ø²ÙˆØ§Ø± Ø§Ù„Ø¬Ø¯Ø¯. Ù‡Ù†Ø§ÙƒØŒ ØªØ¬Ø±ÙŠ Ø£Ù†Ù‡Ø§Ø± Ù…Ù† Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø§Ù„Ø³Ø§Ø®Ù†Ø©ØŒ ÙˆØªØªØ³Ø§Ù‚Ø· Ø«Ù„ÙˆØ¬ Ù…Ù† Ø­Ù„ÙˆÙ‰ Ø§Ù„Ù‚Ø·Ù† Ø§Ù„Ù†Ø§Ø¹Ù…Ø©ØŒ ÙˆØªØ·ÙŠØ± Ø§Ù„Ø£Ø³Ù…Ø§Ùƒ Ø§Ù„Ù…Ù„ÙˆÙ†Ø© ÙÙŠ Ø³Ù…Ø§Ø¡ Ø²Ø±Ù‚Ø§Ø¡ ØµØ§ÙÙŠØ©. ÙÙŠ Ù‚Ù„Ø¨ Ø§Ù„Ù…Ù…Ù„ÙƒØ©ØŒ ÙŠÙ‚ØµØ± ÙƒØ±ÙŠØ³ØªØ§Ù„ÙŠ Ø´ÙØ§Ù ÙŠØ­ÙƒÙ…Ù‡ Ù…Ù„Ùƒ Ø§Ù„Ø£Ø­Ù„Ø§Ù… Ø§Ù„Ø­ÙƒÙŠÙ…ØŒ Ø§Ù„Ø°ÙŠ ÙŠÙˆØ²Ø¹ Ø§Ù„Ø£Ø­Ù„Ø§Ù… Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© Ø¹Ù„Ù‰ ÙƒÙ„ Ù†Ø§Ø¦Ù…. Ù„ÙƒÙ† Ù‡Ø°Ù‡ Ø§Ù„Ù„ÙŠÙ„Ø©ØŒ Ù‡Ù†Ø§Ùƒ Ù…Ù‡Ù…Ø© Ø®Ø§ØµØ©: Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬ÙˆÙ‡Ø±Ø© Ø§Ù„Ù†ÙˆÙ… Ø§Ù„Ø³Ø­Ø±ÙŠ Ø§Ù„ØªÙŠ Ø§Ø®ØªÙØªØŒ ÙˆØ§Ù„ØªÙŠ Ø¨Ø¯ÙˆÙ†Ù‡Ø§ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù„Ù„Ø£Ø­Ù„Ø§Ù… Ø£Ù† ØªÙƒÙˆÙ† Ø­Ù„ÙˆØ©. Ø§Ù„Ø¨Ø·Ù„ Ø§Ù„ØµØºÙŠØ± -Ø£Ù†Øª- Ù…Ø¯Ø¹Ùˆ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©ØŒ Ø­ÙŠØ« Ø³ÙŠÙˆØ§Ø¬Ù‡ ØªØ­Ø¯ÙŠØ§Øª Ø³Ø­Ø±ÙŠØ© ÙˆÙŠÙ‚Ø§Ø¨Ù„ Ø£ØµØ¯Ù‚Ø§Ø¡ Ø¬Ø¯Ø¯ ÙÙŠ Ø±Ø­Ù„Ø© Ù„Ù† ÙŠÙ†Ø³Ø§Ù‡Ø§ Ø£Ø¨Ø¯Ø§Ù‹...' 
            },
            { 
                title: 'Ø£Ø³Ø±Ø§Ø± Ø§Ù„Ù…Ø­ÙŠØ· Ø§Ù„Ù‡Ø§Ø¯Ø¦', 
                content: 'ÙÙŠ Ø£Ø¹Ù…Ø§Ù‚ Ø§Ù„Ù…Ø­ÙŠØ· Ø§Ù„Ø£Ø²Ø±Ù‚ØŒ Ø­ÙŠØ« Ù„Ø§ ÙŠØµÙ„ Ø¶ÙˆØ¡ Ø§Ù„Ø´Ù…Ø³ Ø¥Ù„Ø§ Ø¨Ø´ÙƒÙ„ Ø®Ø§ÙØªØŒ ØªÙˆØ¬Ø¯ Ù…Ø¯ÙŠÙ†Ø© Ù…Ø±Ø¬Ø§Ù†ÙŠØ© Ø³Ø§Ø­Ø±Ø© ÙŠØ³ÙƒÙ†Ù‡Ø§ ÙƒØ§Ø¦Ù†Ø§Øª Ø¨Ø­Ø±ÙŠØ© ÙØ±ÙŠØ¯Ø©. Ø£Ø³Ù…Ø§Ùƒ Ù…Ø¶ÙŠØ¦Ø© ØªØªÙ„Ø£Ù„Ø£ ÙƒØ§Ù„Ù†Ø¬ÙˆÙ… ØªØ­Øª Ø§Ù„Ù…Ø§Ø¡ØŒ ÙˆØ¯Ù„Ø§ÙÙŠÙ† Ø°ÙƒÙŠØ© ØªØ±Ø­Ø¨ Ø¨Ø§Ù„Ø²ÙˆØ§Ø± Ø¨Ù„ØºØ© Ø®Ø§ØµØ©ØŒ ÙˆØ³Ù„Ø§Ø­Ù Ø¨Ø­Ø±ÙŠØ© Ø¹ØªÙŠÙ‚Ø© ØªØ­ÙØ¸ Ø£Ø³Ø±Ø§Ø± Ø§Ù„Ù…Ø­ÙŠØ· Ù…Ù†Ø° Ø¢Ù„Ø§Ù Ø§Ù„Ø³Ù†ÙŠÙ†. ÙØ¬Ø£Ø©ØŒ ÙŠØ³Ù…Ø¹ Ø§Ù„Ø¬Ù…ÙŠØ¹ Ù†ØºÙ…Ø© Ø³Ø­Ø±ÙŠØ© ØªÙ†ØªØ´Ø± ÙÙŠ Ø§Ù„Ù…ÙŠØ§Ù‡ØŒ Ù†ØºÙ…Ø© ØªØ¯Ø¹Ùˆ ÙƒÙ„ Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø­ØªÙØ§Ù„ Ø¨Ø§Ù„Ù„ÙŠÙ„ Ø§Ù„ÙƒØ¨ÙŠØ±ØŒ Ø­ÙŠØ« Ø³ÙŠØªØºÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ù…Ø±Ø¬Ø§Ù† ÙˆÙŠØªØ­ÙˆÙ„ Ø¥Ù„Ù‰ Ø£Ù„ÙˆØ§Ù† Ù‚ÙˆØ³ Ù‚Ø²Ø­ØŒ ÙˆØªØ·ÙÙˆ ÙÙ‚Ø§Ø¹Ø§Øª Ø³Ø­Ø±ÙŠØ© ØªØ­Ù…Ù„ Ø¯Ø§Ø®Ù„Ù‡Ø§ Ø£Ø­Ù„Ø§Ù…Ø§Ù‹ Ø¬Ù…ÙŠÙ„Ø© ØªØµÙ„ Ø¥Ù„Ù‰ Ø³Ø·Ø­ Ø§Ù„Ù…Ø§Ø¡ Ø«Ù… Ø¥Ù„Ù‰ Ø¹Ø§Ù„Ù… Ø§Ù„Ø¨Ø´Ø±. Ù„ÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø± ÙŠÙ‡Ø¯Ø¯ Ø§Ù„Ø§Ø­ØªÙØ§Ù„: Ø¸Ù„ Ø£Ø³ÙˆØ¯ ÙŠØªØ³Ù„Ù„ Ù…Ù† Ø§Ù„Ø£Ø¹Ù…Ø§Ù‚ Ø§Ù„Ù…Ø¸Ù„Ù…Ø©ØŒ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† ØµØ¯Ù‘Ù‡ Ø¥Ù„Ø§ Ø¨Ù‚ÙˆØ© Ø§Ù„Ø£Ø­Ù„Ø§Ù… Ø§Ù„Ø·ÙŠØ¨Ø© ÙˆØ§Ù„Ù†ÙˆØ§ÙŠØ§ Ø§Ù„Ø­Ø³Ù†Ø©...' 
            },
            { 
                title: 'Ù…ØºØ§Ù…Ø±Ø© ÙÙŠ ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø£Ù‚Ù…Ø§Ø±', 
                content: 'ÙÙŠ Ù…ÙƒØ§Ù† Ø¨Ø¹ÙŠØ¯ Ø­ÙŠØ« ØªØ¬ØªÙ…Ø¹ Ø³Ø¨Ø¹Ø© Ø£Ù‚Ù…Ø§Ø± ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡ Ù„ÙŠÙ„Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· ÙƒÙ„ Ø¹Ø§Ù…ØŒ ÙŠÙˆØ¬Ø¯ ÙˆØ§Ø¯ÙŠ Ø³Ø±ÙŠ Ù„Ø§ ÙŠØ¹Ø±ÙÙ‡ Ø¥Ù„Ø§ Ù‚Ù„Ø§Ø¦Ù„. Ù‡Ø°Ù‡ Ø§Ù„Ù„ÙŠÙ„Ø© Ù‡ÙŠ Ø§Ù„Ù„ÙŠÙ„Ø© Ø§Ù„Ø®Ø§ØµØ©ØŒ Ø­ÙŠØ« ØªÙ†Ø²Ù„ Ø§Ù„Ø£Ù‚Ù…Ø§Ø± Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø¡ ÙˆØªØªØ­ÙˆÙ„ Ø¥Ù„Ù‰ ÙƒØ±Ø§Øª Ø¨Ù„ÙˆØ±ÙŠØ© ØªØªØ¯Ø­Ø±Ø¬ ÙÙŠ Ø§Ù„ÙˆØ§Ø¯ÙŠØŒ ØªØ§Ø±ÙƒØ© ÙˆØ±Ø§Ø¡Ù‡Ø§ Ù…Ø³Ø§Ø±Ø§Øª Ù…Ù† Ø§Ù„ØºØ¨Ø§Ø± Ø§Ù„Ù†Ø¬Ù…ÙŠ Ø§Ù„Ù…ØªØ£Ù„Ù‚. ÙƒÙ„ Ù…Ù† ÙŠØªØ¨Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª ÙŠØµÙ„ Ø¥Ù„Ù‰ ÙƒÙ‡Ù Ø§Ù„ÙƒØ±ÙŠØ³ØªØ§Ù„Ø§Øª Ø§Ù„Ù…ØªÙ„Ø£Ù„Ø¦Ø©ØŒ Ø­ÙŠØ« ØªÙˆØ¬Ø¯ Ø£Ø­Ø¬Ø§Ø± ÙƒØ±ÙŠÙ…Ø© ØªØºÙ†ÙŠ Ø¹Ù†Ø¯Ù…Ø§ ØªÙ„Ù…Ø³Ù‡Ø§ Ø£Ø´Ø¹Ø© Ø§Ù„Ù‚Ù…Ø±. Ù„ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„ÙŠØ³ Ø³Ù‡Ù„Ø§Ù‹: ÙŠØ¬Ø¨ Ø¹Ø¨ÙˆØ± Ø¬Ø³Ø± Ù…Ù† Ø§Ù„Ø¶Ø¨Ø§Ø¨ Ø§Ù„Ø³Ø­Ø±ÙŠØŒ ÙˆØ­Ù„ Ø£Ø­Ø¬ÙŠØ© Ø§Ù„Ø£ØµØ¯Ø§Ø¡ Ø§Ù„Ø³Ø¨Ø¹Ø©ØŒ ÙˆØªØ±Ø¯ÙŠØ¯ ÙƒÙ„Ù…Ø© Ø³Ø± ØªØ¹Ù„Ù…ØªÙ‡Ø§ Ø§Ù„Ø±ÙŠØ­ Ù…Ù† Ø£ØºÙ†ÙŠØ§Øª Ø§Ù„Ù†Ø¬ÙˆÙ… Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©. ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©ØŒ ÙŠÙ†ØªØ¸Ø± ÙƒÙ†Ø² Ù„Ø§ ÙŠÙ‚Ø¯Ø± Ø¨Ø«Ù…Ù†: Ø­Ø¬Ø± Ø§Ù„Ø­ÙƒÙ…Ø© Ø§Ù„Ø°ÙŠ ÙŠÙ…Ù†Ø­ Ø­Ø§Ù…Ù„Ù‡ ÙÙ‡Ù… Ù„ØºØ© ÙƒÙ„ Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª ÙÙŠ Ø§Ù„ÙƒÙˆÙ†...' 
            },
            { 
                title: 'Ù‚Ù„Ø¹Ø© Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø·Ø§Ø¦Ø±Ø©', 
                content: 'Ø¹Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡ØŒ ÙÙˆÙ‚ Ø£Ø¹Ù„Ù‰ Ø§Ù„ØºÙŠÙˆÙ…ØŒ ØªØ·ÙÙˆ Ù‚Ù„Ø¹Ø© Ø³Ø­Ø±ÙŠØ© Ù…ØµÙ†ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…ØªÙ„Ø£Ù„Ø¦Ø© ÙˆØ§Ù„Ø¶Ø¨Ø§Ø¨ Ø§Ù„Ø°Ù‡Ø¨ÙŠ. Ø¬Ø¯Ø±Ø§Ù†Ù‡Ø§ ØªØªØºÙŠØ± Ø£Ù„ÙˆØ§Ù†Ù‡Ø§ Ù…Ø¹ ÙƒÙ„ ØºØ±ÙˆØ¨ Ø´Ù…Ø³ØŒ ÙˆØ£Ø¨Ø±Ø§Ø¬Ù‡Ø§ ØªØ¯ÙˆØ± Ø¨Ø¨Ø·Ø¡ Ù„ØªØªØ¨Ø¹ Ø­Ø±ÙƒØ© Ø§Ù„Ù†Ø¬ÙˆÙ…. Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ù„Ø¹Ø©ØŒ ØªØ¹ÙŠØ´ ÙƒØ§Ø¦Ù†Ø§Øª Ø§Ù„Ù‡ÙˆØ§Ø¡ Ø§Ù„Ø®ÙÙŠÙØ© Ø§Ù„ØªÙŠ ØªÙ†Ø³Ø¬ Ø£Ø­Ù„Ø§Ù… Ø§Ù„Ø·ÙŠØ±Ø§Ù† Ù…Ù† Ø®ÙŠÙˆØ· Ø§Ù„Ø¶Ø¨Ø§Ø¨ ÙˆØ£Ø´Ø¹Ø© Ø§Ù„Ù‚Ù…Ø±. Ù‡Ø°Ù‡ Ø§Ù„Ù„ÙŠÙ„Ø©ØŒ ØªÙ‚Ø§Ù… Ø±Ù‚ØµØ© Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙƒØ¨Ø±Ù‰ØŒ Ø­ÙŠØ« ØªØªÙ†Ù‚Ù„ Ø§Ù„Ù‚Ù„Ø¹Ø© Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¬Ø±Ø§Øª ÙˆØªØ²ÙˆØ± Ø¹ÙˆØ§Ù„Ù… Ù…Ø®ØªÙ„ÙØ© ÙÙŠ Ø±Ø­Ù„Ø© Ù„Ø§ ØªÙ†ØªÙ‡ÙŠ. Ù„ÙƒÙ† ÙØ¬Ø£Ø©ØŒ ØªØ¨Ø¯Ø£ Ø§Ù„Ù‚Ù„Ø¹Ø© ØªÙÙ‚Ø¯ Ù‚Ø¯Ø±ØªÙ‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø·ÙŠØ±Ø§Ù†ØŒ ÙˆÙŠØ¨Ø¯Ùˆ Ø£Ù† Ø³Ø­Ø±Ù‡Ø§ ÙŠØªÙ„Ø§Ø´Ù‰. Ø§Ù„Ø­Ù„ Ø§Ù„ÙˆØ­ÙŠØ¯ Ù‡Ùˆ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ù‡Ø±Ø© Ø§Ù„Ø¶Ø¨Ø§Ø¨ Ø§Ù„Ù†Ø§Ø¯Ø±Ø© Ø§Ù„ØªÙŠ ØªÙ†Ù…Ùˆ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø­ÙˆØ§Ù Ù‚ÙˆØ³ Ù‚Ø²Ø­ØŒ ÙˆØ§Ù„ØªÙŠ ÙŠÙ…ÙƒÙ† Ø£Ù† ØªØ¬Ø¯Ø¯ Ø·Ø§Ù‚Ø© Ø§Ù„Ù‚Ù„Ø¹Ø© Ø§Ù„Ø³Ø­Ø±ÙŠØ©. Ø§Ù„Ø±Ø­Ù„Ø© Ø®Ø·ÙŠØ±Ø© ÙˆÙ„ÙƒÙ†Ù‡Ø§ Ø¶Ø±ÙˆØ±ÙŠØ© Ù„Ø¥Ù†Ù‚Ø§Ø° Ø¹Ø§Ù„Ù… Ø§Ù„Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø³Ù‚ÙˆØ· Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶...' 
            },
            { 
                title: 'Ù„ØºØ² Ø§Ù„ØºØ§Ø¨Ø© Ø§Ù„Ù…ØªÙƒÙ„Ù…Ø©', 
                content: 'ÙÙŠ ØºØ§Ø¨Ø© Ø­ÙŠØ« ØªØªÙƒÙ„Ù… Ø§Ù„Ø£Ø´Ø¬Ø§Ø± ÙˆØªØºÙ†ÙŠ Ø§Ù„Ø£Ø²Ù‡Ø§Ø±ØŒ ÙƒÙ„ Ø´ÙŠØ¡ Ø­ÙŠ ÙˆÙˆØ§Ø¹ÙŠ. Ø§Ù„Ø£Ø´Ø¬Ø§Ø± Ø§Ù„Ø¹ØªÙŠÙ‚Ø© ØªØ­ÙƒÙŠ Ù‚ØµØµØ§Ù‹ Ø¹Ù† Ø¹ØµÙˆØ± Ù…Ø¶ØªØŒ ÙˆØ§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª ØªÙÙ‡Ù… Ù„ØºØ© Ø§Ù„Ø¨Ø´Ø± ÙˆØªØªØ­Ø¯Ø« Ù…Ø¹Ù‡Ù…. Ù„ÙƒÙ† Ù…Ø¤Ø®Ø±Ø§Ù‹ØŒ Ø´ÙŠØ¡ ØºØ±ÙŠØ¨ Ø¨Ø¯Ø£ ÙŠØ­Ø¯Ø«: Ø§Ù„Ø£Ø´Ø¬Ø§Ø± ÙÙ‚Ø¯Øª Ù‚Ø¯Ø±ØªÙ‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù…ØŒ ÙˆØ§Ù„Ø£Ø²Ù‡Ø§Ø± ØªÙˆÙ‚ÙØª Ø¹Ù† Ø§Ù„ØºÙ†Ø§Ø¡ØŒ ÙˆØ§Ù„ØºØ§Ø¨Ø© ÙƒÙ„Ù‡Ø§ ØªØºØ±Ù‚ ÙÙŠ ØµÙ…Øª Ù…Ø®ÙŠÙ. Ø§Ù„Ø£Ø³Ø·ÙˆØ±Ø© ØªÙ‚ÙˆÙ„ Ø£Ù† Ù…ÙØªØ§Ø­ Ø§Ù„ÙƒÙ„Ø§Ù… Ù‚Ø¯ Ø³Ø±Ù‚ Ù…Ù† Ù‚Ø¨Ù„ Ø¸Ù„ Ø§Ù„Ù„ÙŠÙ„ØŒ ÙˆÙ‡Ùˆ ÙƒØ§Ø¦Ù† Ø®ÙÙŠ ÙŠØ¹ÙŠØ´ ÙÙŠ ÙƒÙ‡Ù Ø§Ù„Ù†Ø³ÙŠØ§Ù†. Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ÙƒÙ„Ø§Ù…ØŒ ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ù„ Ø£Ù† ÙŠØ¬Ø¯ Ø·Ø±ÙŠÙ‚Ø§Ù‹ Ø¥Ù„Ù‰ Ø§Ù„ÙƒÙ‡Ù Ø§Ù„Ù…Ø¸Ù„Ù…ØŒ ÙˆÙŠÙˆØ§Ø¬Ù‡ Ø§Ù„Ø¸Ù„ ÙÙŠ Ù…Ø¹Ø±ÙƒØ© Ù„ÙŠØ³ Ø¨Ø§Ù„Ø³Ù„Ø§Ø­ ÙˆÙ„ÙƒÙ† Ø¨Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© ÙˆØ§Ù„Ø£ØºØ§Ù†ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©. ÙÙ‚Ø· Ù…Ù† ÙŠØªØ°ÙƒØ± Ø£ØºÙ†ÙŠØ© Ø§Ù„Ù…Ù‡Ø¯ Ø§Ù„ØªÙŠ ÙƒØ§Ù†Øª ØªØºÙ†ÙŠÙ‡Ø§ Ù„Ù‡ Ø£Ù…Ù‡ ÙˆÙ‡Ùˆ Ø·ÙÙ„ ÙŠÙ…ÙƒÙ†Ù‡ Ù‡Ø²ÙŠÙ…Ø© Ø§Ù„Ø¸Ù„ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­ÙŠØ§Ø© Ø¥Ù„Ù‰ Ø§Ù„ØºØ§Ø¨Ø© Ø§Ù„Ù…ØªÙƒÙ„Ù…Ø©...' 
            }
        ];

        const storiesEn = [
            { 
                title: 'A Night in the Enchanted Forest', 
                content: 'Deep in the ancient forest, where giant trees touch the sky with their intertwined branches, a great secret awaits discovery. Under the silver moonlight piercing through dense leaves, nocturnal creatures begin their magical journey. Butterflies glowing with rainbow colors dance in the air, and forest animals gather around a clear lake reflecting stars like a magical mirror. Suddenly, a path of shimmering light appears on the ground, leading to an ancient tree at the heart of the forest, where legend says heart\'s wishes come true for those who find it at midnight. The wind whispers an old song, faint lights paint magical patterns on tree trunks, as if the entire forest prepares for a great event that will change the fate of everyone within...' 
            },
            { 
                title: 'Journey to the Kingdom of Dreams', 
                content: 'At the edge of the real world, where imagination meets reality, lies the great Kingdom of Dreams. Every night when children close their eyes, the silver gates of the kingdom open to welcome new visitors. There, rivers of hot chocolate flow, cotton candy snow falls softly, and colorful fish fly in a clear blue sky. At the kingdom\'s heart stands a transparent crystal palace ruled by the wise King of Dreams, who distributes beautiful dreams to every sleeper. But tonight, there\'s a special mission: to find the magical Sleep Gem that has disappeared, without which dreams cannot be sweet. The little hero - you - is invited on this great adventure, where you\'ll face magical challenges and meet new friends on a journey you\'ll never forget...' 
            },
            { 
                title: 'Secrets of the Peaceful Ocean', 
                content: 'In the depths of the blue ocean, where sunlight reaches only faintly, exists an enchanting coral city inhabited by unique sea creatures. Glowing fish twinkle like stars underwater, intelligent dolphins welcome visitors with a special language, and ancient sea turtles hold ocean secrets for thousands of years. Suddenly, everyone hears a magical melody spreading through the water, a tune inviting all creatures to celebrate the Great Night, when coral changes color to rainbow hues, and magical bubbles float up carrying beautiful dreams that reach the water surface then the human world. But a danger threatens the celebration: a black shadow creeping from the dark depths, which can only be repelled by the power of good dreams and pure intentions...' 
            },
            { 
                title: 'Adventure in the Valley of Moons', 
                content: 'In a faraway place where seven moons gather in the sky only one night each year, exists a secret valley known to few. Tonight is the special night, when moons descend from the sky turning into crystalline balls rolling through the valley, leaving trails of shimmering stardust. Anyone following these trails reaches the cave of sparkling crystals, where gemstones sing when touched by moonlight. But the journey isn\'t easy: one must cross a bridge of magical mist, solve the riddle of the seven echoes, and recite a secret word the wind learned from ancient star songs. In the end, awaits a priceless treasure: the Stone of Wisdom granting its bearer understanding of every creature\'s language in the universe...' 
            },
            { 
                title: 'The Castle of Flying Clouds', 
                content: 'High in the sky, above the highest clouds, floats a magical castle made of shimmering clouds and golden mist. Its walls change colors with each sunset, its towers rotate slowly to follow star movements. Inside the castle live light air creatures who weave dreams of flight from threads of mist and moonbeams. Tonight, the Great Cloud Dance takes place, where the castle travels between galaxies visiting different worlds on an endless journey. But suddenly, the castle begins losing its ability to fly, its magic seems to fade. The only solution is finding the rare Mist Flower that grows only on rainbow edges, which can renew the castle\'s magical energy. The journey is dangerous but necessary to save the cloud world from falling to earth...' 
            },
            { 
                title: 'The Mystery of the Talking Forest', 
                content: 'In a forest where trees speak and flowers sing, everything is alive and conscious. Ancient trees tell stories of past eras, animals understand human language and talk with them. But recently, something strange began happening: trees lost their ability to speak, flowers stopped singing, the entire forest sinks into frightening silence. Legend says the Key of Speech was stolen by the Shadow of Night, a hidden creature living in the Cave of Forgetfulness. To restore speech, the hero must find a way to the dark cave, face the shadow in a battle not with weapons but with beautiful memories and old songs. Only someone who remembers the lullaby their mother sang as a child can defeat the shadow and bring life back to the Talking Forest...' 
            }
        ];

        function loadStories() {
            const stories = currentLang === 'ar' ? storiesAr : storiesEn;
            const dayIndex = new Date().getDate() % stories.length;
            const container = document.getElementById('storiesContent');
            
            container.innerHTML = `
                <div class="space-y-4">
                    ${stories.map((s, i) => `
                        <div class="bg-gradient-to-br from-amber-800/50 to-orange-900/50 rounded-2xl p-6 cursor-pointer" onclick="showStory(${i})">
                            <h4 class="text-xl font-bold mb-2">ğŸ“– ${s.title}</h4>
                            <p class="text-amber-200 line-clamp-2">${s.content.substring(0, 100)}...</p>
                            ${i === dayIndex ? `<span class="bg-amber-600 text-xs px-2 py-1 rounded-full mt-2 inline-block">${currentLang === 'ar' ? 'Ù‚ØµØ© Ø§Ù„ÙŠÙˆÙ…' : "Today's Story"}</span>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        window.showStory = function(index) {
            const stories = currentLang === 'ar' ? storiesAr : storiesEn;
            const story = stories[index];
            const container = document.getElementById('storiesContent');
            
            container.innerHTML = `
                <button onclick="loadStories()" class="mb-4 bg-gray-700 px-4 py-2 rounded-lg">â† ${currentLang === 'ar' ? 'Ø±Ø¬ÙˆØ¹' : 'Back'}</button>
                <div class="bg-gradient-to-br from-amber-800/50 to-orange-900/50 rounded-2xl p-6">
                    <h3 class="text-2xl font-bold mb-4">${story.title}</h3>
                    <p class="text-lg leading-relaxed text-amber-100">${story.content}</p>
                    <div class="flex flex-wrap gap-2 mt-6">
                        <button onclick="readStory('ar-SA')" class="bg-amber-600 hover:bg-amber-700 px-4 py-2 rounded-lg">ğŸ”Š ${currentLang === 'ar' ? 'ØµÙˆØª Ø¹Ø±Ø¨ÙŠ' : 'Arabic'}</button>
                        <button onclick="readStory('en-US')" class="bg-amber-600 hover:bg-amber-700 px-4 py-2 rounded-lg">ğŸ”Š English</button>
                    </div>
                </div>
            `;
        };

        window.readStory = function(lang) {
            let text = document.querySelector('#storiesContent p.text-lg').textContent;
            text = cleanTextForSpeech(text);
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            utterance.rate = 0.85;
            const voices = speechSynthesis.getVoices();
            const voice = voices.find(v => v.lang === lang && (v.name.includes('Female') || v.name.includes('Samantha')));
            if (voice) utterance.voice = voice;
            speechSynthesis.speak(utterance);
        };

        // Music Section (rotates daily + per refresh)
        function buildPanelMusicUrl(id) {
            // Panel embeds should be fully controllable by the user and work reliably.
            // We avoid forcing autoplay here to reduce blocking; user can press play.
            const base = `https://www.youtube.com/embed/${id}`;
            const params = new URLSearchParams({
                rel: '0',
                modestbranding: '1',
                playsinline: '1',
                controls: '1',
                enablejsapi: '1',
                origin: location.origin
            });
            return `${base}?${params.toString()}`;
        }

        function loadMusic() {
            // Rotate the panel list daily + per refresh.
            // To help ensure ALL embeds can play, we:
            // - allow user controls
            // - keep allow="autoplay" enabled
            // - add origin/enablejsapi
            const day = getDayOfYear();
            const pool = [...bgMusicPool];

            // Stable daily shuffle with a per-refresh salt (so it changes on refresh too)
            const salt = Math.floor(Math.random() * 100000);
            for (let i = pool.length - 1; i > 0; i--) {
                const j = (day + salt + i * 17) % (i + 1);
                [pool[i], pool[j]] = [pool[j], pool[i]];
            }

            const musicList = pool.slice(0, 6).map(t => ({
                title: currentLang === 'ar' ? t.titleAr : t.titleEn,
                id: t.id
            }));

            const container = document.getElementById('musicContent');
            container.innerHTML = musicList.map(m => `
                <div class="bg-gradient-to-br from-blue-800/50 to-sky-900/50 rounded-2xl p-4">
                    <h4 class="font-bold mb-2">ğŸµ ${m.title}</h4>
                    <iframe
                        width="100%" height="200"
                        src="${buildPanelMusicUrl(m.id)}"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen
                        class="rounded-lg"
                    ></iframe>
                </div>
            `).join('');
        }

        // Visitor Counter
        function updateVisitors() {
            let visitors = parseInt(localStorage.getItem('visitors') || '0') + 1;
            localStorage.setItem('visitors', visitors);
            document.getElementById('visitors').textContent = visitors;
            document.getElementById('adminVisitors').textContent = visitors;
        }

        // Admin System
        function showAdminLogin() {
            document.getElementById('adminModal').classList.remove('hidden');
            document.getElementById('adminLogin').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
        }

        function closeAdmin() {
            document.getElementById('adminModal').classList.add('hidden');
        }

        function checkAdmin() {
            const pass = document.getElementById('adminPassword').value;
            if (pass === 'admin123') {
                document.getElementById('adminLogin').classList.add('hidden');
                document.getElementById('adminDashboard').classList.remove('hidden');
                loadAdminMessages();
            } else {
                alert(currentLang === 'ar' ? 'Ø±Ù…Ø² Ø®Ø§Ø·Ø¦!' : 'Wrong code!');
            }
            document.getElementById('adminPassword').value = '';
        }

        function loadAdminMessages() {
            const msgs = JSON.parse(localStorage.getItem('chatMessages') || '[]');
            const container = document.getElementById('adminMessages');
            container.innerHTML = msgs.length ? msgs.map(m => `
                <div class="bg-gray-600 rounded p-2 text-sm">
                    <div class="text-purple-300 text-xs">${m.time}</div>
                    <div>${m.msg}</div>
                </div>
            `).join('') : `<div class="text-gray-400">${currentLang === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„' : 'No messages'}</div>`;
        }

        // Load all content
        function loadContent() {
            displayQuote();
            loadGames();
            loadRelaxation();
            loadStories();
            loadMusic();
        }

        // Initialize
        window.onload = function() {
            updateVisitors();
            loadContent();
            speechSynthesis.getVoices();
        };

        // Welcome message in chat
        setTimeout(() => {
            const welcomeMsg = currentLang === 'ar' 
                ? 'Ù‡Ù„Ø§ ÙˆØ§Ù„Ù„Ù‡! Ø£Ù†Ø§ ØµØ¯ÙŠÙ‚Ùƒ ÙÙŠ Ù…Ù„Ø§Ø°Ùƒ Ø§Ù„Ø¢Ù…Ù† ğŸ’œ\nÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø£Ø³Ø¹Ø¯Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ Ù‡Ù„ ØªØ¨ÙŠ ØªØ­ÙƒÙŠ Ø£Ùˆ ØªÙ„Ø¹Ø¨ Ø£Ùˆ ØªØ³ØªÙ…Ø¹ Ù„Ø´ÙŠØ¡ Ø¬Ù…ÙŠÙ„ØŸ ğŸ˜Š'
                : 'Hello! I\'m your friend at Safe Haven ğŸ’œ\nHow can I make your day better? Do you want to talk, play games, or listen to something beautiful? ğŸ˜Š';
            
            document.getElementById('chatMessages').innerHTML = `
                <div class="chat-bubble flex justify-start">
                    <div class="bg-gray-700 rounded-2xl rounded-bl-sm px-4 py-2 max-w-[80%] whitespace-pre-line">
                        ${welcomeMsg}
                    </div>
                </div>
            `;
        }, 500);
    </script>
</body>
</html>
