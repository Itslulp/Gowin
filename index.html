<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موقعي الآمن - PWA</title>

    <!-- ربط ملف manifest.json الخاص بالـ PWA -->
    <!-- المسار يجب أن يشمل اسم الريبو على GitHub Pages -->
    <link rel="manifest" href="/safe-haven.com/manifest.json">

    <!-- تحديد لون شريط المتصفح ليتناسب مع تصميم PWA (من manifest.json) -->
    <meta name="theme-color" content="#007bff">

    <!-- كود ملف قوقل (مثال: Google Site Verification) -->
    <!-- إذا كان ملفك هو 'googlec5f6c58e64a8bd8e.html' فقط ضعه في المجلد الرئيسي لموقعك ولا حاجة لكتابة كود هنا. -->
    <!-- إذا كان كود تأكيد مثل هذا الميتا تاج، ضعه هنا: -->
    <!-- <meta name="google-site-verification" content="YOUR_VERIFICATION_CODE_HERE" /> -->

    <!-- إذا كان ملف قوقل يقصد به Google Analytics، ضع كود Analytics هنا: -->
    <!--
    <script async src="https://www.googletagmanager.com/gtag/js?id=YOUR_GA_MEASUREMENT_ID"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'YOUR_GA_MEASUREMENT_ID');
    </script>
    -->

    <!-- تصميم CSS بسيط (يمكنك وضع هذا في ملف style.css وربطه) -->
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #222; /* لون خلفية داكن */
            color: #eee; /* لون نص فاتح */
            line-height: 1.6;
            direction: rtl; /* لضمان دعم اللغة العربية بشكل جيد */
            text-align: right; /* محاذاة النص لليمين للعربية */
        }
        .container {
            max-width: 960px;
            margin: 20px auto;
            padding: 20px;
            background-color: #333;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            border-radius: 8px;
        }
        header {
            background-color: #1a1a1a;
            padding: 15px 20px;
            border-bottom: 1px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* للسماح للعناصر بالنزول لسطر جديد على الشاشات الصغيرة */
        }
        header h1 {
            margin: 0;
            color: #fff;
            font-size: 1.8em;
        }
        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            gap: 15px;
        }
        nav ul li a {
            color: #bbb;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        nav ul li a:hover {
            color: #007bff;
        }
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-top: 0; /* لضمان عدم وجود مسافة علوية غير ضرورية */
        }
        .action-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }
        .action-button:hover {
            background-color: #0056b3;
        }
        #installAppButton {
            display: none; /* يتم إظهاره بواسطة JavaScript عند توفر إمكانية التثبيت */
        }
        h2 {
            color: #007bff;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
            margin-top: 30px;
        }
        .visitor-counter {
            background-color: #444;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 1.1em;
            text-align: center;
        }
        .guestbook-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .guestbook-form input[type="text"],
        .guestbook-form textarea {
            width: calc(100% - 20px); /* 100% عرض مع خصم البادينج */
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #555;
            border-radius: 5px;
            background-color: #444;
            color: #eee;
        }
        .guestbook-form textarea {
            resize: vertical;
            min-height: 100px;
        }
        .guestbook-form button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }
        .guestbook-form button:hover {
            background-color: #218838;
        }
        .messages-list {
            list-style: none;
            padding: 0;
            margin-top: 20px;
        }
        .messages-list li {
            background-color: #444;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 5px solid #007bff;
        }
        .messages-list li strong {
            color: #007bff;
            display: block;
            margin-bottom: 5px;
        }
        @media (max-width: 600px) {
            header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            nav ul {
                flex-direction: column;
                gap: 5px;
            }
            .header-actions {
                width: 100%;
                justify-content: space-around;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>موقعي الشخصي</h1>
        <nav>
            <ul>
                <li><a href="/safe-haven.com/">الرئيسية</a></li>
                <li><a href="/safe-haven.com/about.html">عنا</a></li> <!-- مثال لصفحة أخرى -->
                <li><a href="/safe-haven.com/services.html">الخدمات</a></li> <!-- مثال لصفحة أخرى -->
                <li><a href="/safe-haven.com/contact.html">تواصل معنا</a></li> <!-- مثال لصفحة أخرى -->
            </ul>
        </nav>
        <div class="header-actions">
            <button id="installAppButton" class="action-button">تثبيت التطبيق</button>
            <button id="languageToggleButton" class="action-button">English</button>
        </div>
    </header>

    <div class="container">
        <h2>أهلاً بك في موقعنا!</h2>
        <p>هذا مثال بسيط لتطبيق ويب تقدمي (PWA) مع بعض الميزات الإضافية التي طلبتها.</p>

        <!-- عداد الزوار -->
        <div class="visitor-counter">
            <p>عدد الزوار (لك شخصيًا): <span id="visitorCount">0</span></p>
        </div>

        <!-- قسم رسائل الزوار (كتاب الضيوف) -->
        <h2>رسائل الزوار</h2>
        <form id="guestbookForm" class="guestbook-form">
            <label for="visitorName">اسمك:</label>
            <input type="text" id="visitorName" required>

            <label for="visitorMessage">رسالتك:</label>
            <textarea id="visitorMessage" required></textarea>

            <button type="submit">إرسال الرسالة</button>
        </form>

        <ul id="messagesList" class="messages-list">
            <!-- الرسائل ستظهر هنا بواسطة JavaScript -->
        </ul>
    </div>

    <!-- كود JavaScript -->
    <script>
        // 1. تسجيل Service Worker (لجعل الموقع PWA)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // يجب أن يشمل مسار Service Worker اسم الريبو
                navigator.serviceWorker.register('/safe-haven.com/sw.js')
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }

        // 2. زر تثبيت التطبيق (PWA Install Prompt)
        let deferredPrompt;
        const installAppButton = document.getElementById('installAppButton');

        window.addEventListener('beforeinstallprompt', (e) => {
            // منع ظهور الشعار التلقائي للمتصفح
            e.preventDefault();
            // تخزين الحدث بحيث يمكن تشغيله لاحقًا
            deferredPrompt = e;
            // إظهار زر التثبيت الخاص بنا
            installAppButton.style.display = 'block';
            console.log('beforeinstallprompt fired');
        });

        installAppButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                // إخفاء الزر بعد الضغط عليه
                installAppButton.style.display = 'none';
                // عرض تنبيه التثبيت للمستخدم
                deferredPrompt.prompt();
                // انتظار رد المستخدم
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to install prompt: ${outcome}`);
                // إعادة تعيين deferredPrompt لأن الحدث يمكن استخدامه مرة واحدة فقط
                deferredPrompt = null;
            }
        });

        // 3. زر تغيير اللغة
        const languageToggleButton = document.getElementById('languageToggleButton');
        const htmlElement = document.documentElement; // عنصر <html>

        // حفظ اللغة المفضلة للمستخدم في التخزين المحلي
        let currentLang = localStorage.getItem('appLang') || 'ar'; // الافتراضي عربي

        // وظيفة لتحديث نصوص الصفحة بناءً على اللغة
        function updateContentForLanguage(lang) {
            if (lang === 'en') {
                document.title = 'My Safe Site - PWA';
                document.querySelector('header h1').textContent = 'My Personal Website';
                document.querySelector('nav ul li:nth-child(1) a').textContent = 'Home';
                document.querySelector('nav ul li:nth-child(2) a').textContent = 'About Us';
                document.querySelector('nav ul li:nth-child(3) a').textContent = 'Services';
                document.querySelector('nav ul li:nth-child(4) a').textContent = 'Contact Us';
                document.querySelector('.container h2:nth-of-type(1)').textContent = 'Welcome to Our Website!';
                document.querySelector('.container p').textContent = 'This is a simple example of a Progressive Web App (PWA) with some extra features you requested.';
                document.querySelector('.visitor-counter p').innerHTML = 'Visitor Count (for you): <span id="visitorCount">' + (localStorage.getItem('page_visits') || 0) + '</span>';
                document.querySelector('.container h2:nth-of-type(2)').textContent = 'Guest Messages';
                document.querySelector('#guestbookForm label[for="visitorName"]').textContent = 'Your Name:';
                document.querySelector('#guestbookForm label[for="visitorMessage"]').textContent = 'Your Message:';
                document.querySelector('#guestbookForm button[type="submit"]').textContent = 'Send Message';
                languageToggleButton.textContent = 'العربية';
            } else { // 'ar'
                document.title = 'موقعي الآمن - PWA';
                document.querySelector('header h1').textContent = 'موقعي الشخصي';
                document.querySelector('nav ul li:nth-child(1) a').textContent = 'الرئيسية';
                document.querySelector('nav ul li:nth-child(2) a').textContent = 'عنا';
                document.querySelector('nav ul li:nth-child(3) a').textContent = 'الخدمات';
                document.querySelector('nav ul li:nth-child(4) a').textContent = 'تواصل معنا';
                document.querySelector('.container h2:nth-of-type(1)').textContent = 'أهلاً بك في موقعنا!';
                document.querySelector('.container p').textContent = 'هذا مثال بسيط لتطبيق ويب تقدمي (PWA) مع بعض الميزات الإضافية التي طلبتها.';
                document.querySelector('.visitor-counter p').innerHTML = 'عدد الزوار (لك شخصيًا): <span id="visitorCount">' + (localStorage.getItem('page_visits') || 0) + '</span>';
                document.querySelector('.container h2:nth-of-type(2)').textContent = 'رسائل الزوار';
                document.querySelector('#guestbookForm label[for="visitorName"]').textContent = 'اسمك:';
                document.querySelector('#guestbookForm label[for="visitorMessage"]').textContent = 'رسالتك:';
                document.querySelector('#guestbookForm button[type="submit"]').textContent = 'إرسال الرسالة';
                languageToggleButton.textContent = 'English';
            }
            htmlElement.setAttribute('lang', lang);
            htmlElement.style.direction = (lang === 'en' ? 'ltr' : 'rtl');
            document.body.style.textAlign = (lang === 'en' ? 'left' : 'right');
            localStorage.setItem('appLang', lang); // حفظ اللغة
        }

        // تطبيق اللغة عند تحميل الصفحة
        updateContentForLanguage(currentLang);


        languageToggleButton.addEventListener('click', () => {
            currentLang = (currentLang === 'ar' ? 'en' : 'ar');
            updateContentForLanguage(currentLang);
        });


        // 4. عداد الزوار (هذا العداد يحسب زياراتك أنت فقط باستخدام localStorage)
        const visitorCountElement = document.getElementById('visitorCount');
        let visitorCount = localStorage.getItem('page_visits');
        if (visitorCount) {
            visitorCount = parseInt(visitorCount) + 1;
        } else {
            visitorCount = 1;
        }
        localStorage.setItem('page_visits', visitorCount);
        visitorCountElement.textContent = visitorCount;

        // ملاحظة: لعداد زوار عالمي يراه الجميع، ستحتاج إلى backend (خادم وقاعدة بيانات).

        // 5. رسائل الزوار (كتاب الضيوف - تخزين محلي فقط)
        const guestbookForm = document.getElementById('guestbookForm');
        const visitorNameInput = document.getElementById('visitorName');
        const visitorMessageInput = document.getElementById('visitorMessage');
        const messagesList = document.getElementById('messagesList');

        // تحميل الرسائل الموجودة عند تحميل الصفحة
        function loadMessages() {
            messagesList.innerHTML = ''; // مسح الرسائل الموجودة
            const messages = JSON.parse(localStorage.getItem('guestbook_messages')) || [];
            messages.forEach(msg => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${msg.name}</strong> - <span>${new Date(msg.timestamp).toLocaleString()}</span><p>${msg.message}</p>`;
                messagesList.prepend(li); // إضافة الرسائل الأحدث في الأعلى
            });
        }

        // عند إرسال النموذج
        guestbookForm.addEventListener('submit', (e) => {
            e.preventDefault(); // منع تحديث الصفحة

            const name = visitorNameInput.value;
            const message = visitorMessageInput.value;
            const timestamp = new Date().toISOString(); // تاريخ ووقت الإرسال

            if (name && message) {
                const messages = JSON.parse(localStorage.getItem('guestbook_messages')) || [];
                messages.push({ name, message, timestamp });
                localStorage.setItem('guestbook_messages', JSON.stringify(messages));

                visitorNameInput.value = '';
                visitorMessageInput.value = '';
                loadMessages(); // إعادة تحميل الرسائل لعرض الجديدة
            }
        });

        // تشغيل تحميل الرسائل عند بداية تحميل الصفحة
        loadMessages();
    </script>
</body>
</html>
